---
title: "SOAK Census 2024"
output:
  pdf_document: default
  html_document: default
  word_document: default
header-includes:
  - \usepackage{float}
---

This document was created by Amanda "Tuna" Welch, M.S.
Contributions made by Tracy Mehoke in Residence section.

All data was collected on site between May 22 and May 24, 2024 by sampling vehicles upon entry. A total of 941 surveys were collected. Box Office recorded 2,328 tickets used for entry.

Data was input by volunteers into Qualtrics and raw numbers were downloaded for analysis.

Analysis and visualization done in R and RStudio.
  RStudio Team (2022). RStudio: Integrated Development Environment for R. RStudio, PBC,
  Boston, MA URL http://www.rstudio.com/.

Code and data available on Github at https://github.com/amcowelch/SOAK-Census

For questions or comments: census@soakpdx.com or tuna@soakpdx.com



```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
options(warn = -1)
library(ggplot2)
library(janitor)
library(dplyr)
library(stringr)
library(RColorBrewer)
library(scales)
library(ggrepel)
library(tidyverse)
library(kableExtra)
```

```{r, include=FALSE}
# set working directory
setwd("C:/Users/Amanda Welch/Documents/GitHub/SOAK-Census")
```

```{r data import}
# import data
data <- read.csv("C:/Users/Amanda Welch/Desktop/SOAK 2023/census_data.csv") 

# convert column names to lower case
data <- clean_names(data)

#remove 1st 2 rows with unnecessary info
data <- data[-(1:2),]
```

```{r import 2024 data}
data_2024 <- read.csv("C:/Users/Amanda Welch/Desktop/SOAK 2024/SOAK 2024_RawData.csv")
```

```{r clean 2024 data}
data_2024 <- clean_names(data_2024)
data_2024 <- data_2024[-(1:2),]
data_2024 <- data_2024[, !names(data_2024) %in%
               c("start_date","end_date","status","ip_address","progress","duration_in_seconds",
                 "finished","recorded_date","response_id","recipient_last_name",
                 "recipient_first_name", "recipient_email","external_reference","location_latitude",
                 "location_longitude","distribution_channel","user_language","q_recaptcha_score")]
```

```{r columns 2024}
# rename columns for 2024
data_2024 <- data_2024 %>% 
  dplyr::rename(
    attend = q1,
    age = q2,
    race = q3,
    born = q4,
    language = q5,
    gender = q6,
    orientation = q7,
    relationship = q8,
    religion = q9,
    politics = q10,
    edu = q11,
    income = q12,
    zip_code = q13,
    arrive = q14,
    rv = q15,
    ticket = q16,
    move = q17,
    participate = q18,
    sustain = q19,
    townhall = q22,
    bm = q23,
    info = q24,
    ada = q25,
    military = q26,
    kids = q27,
    teens = q28,
    time_arrival = q29
    
  )
```

``` {r data cleaning 2023}
# drop irrelevant columns generated by data entry 
data <- data[, !names(data) %in%
               c("start_date","end_date","status","ip_address","progress","duration_in_seconds",
                 "finished","recorded_date","response_id","recipient_last_name",
                 "recipient_first_name", "recipient_email","external_reference","location_latitude",
                 "location_longitude","distribution_channel","user_language","q_recaptcha_score")]

# rename columns
data <- data %>% 
  dplyr::rename(
    attend = q1,
    age = q2,
    race = q3,
    born = q4,
    language = q5,
    gender = q6,
    orientation = q7,
    relationship = q8,
    religion = q9,
    politics = q10,
    edu = q11,
    income = q12,
    zip_code = q13,
    arrive = q14,
    rv = q15,
    ticket = q16,
    move = q17,
    participate = q18,
    sustain = q19,
    kids = q20,
    teens = q21,
    townhall = q22,
    bm = q23,
    info = q24
  )

# re-writing this entry - entered with "it's my 1st year" as well which can't be true if they also attended 3 years prior
data$attend[328] <- "2022,2019,2018"
```
<br>
<br>

# Attendance

### Previous Years Attended

```{r attendance 2023}
# rows (sometimes) store several year
# pull them out and separate years so they can be counted individually
attend_list <- strsplit(data$attend, ",")
attend_unlist <- unlist(attend_list)
occurrences <- table(attend_unlist)
occurrences_df <- as.data.frame(occurrences)

# get attendance count
# counting using commas - 0 commas per row means only have attended once, 1 comma = twice, etc.
# exclude virgins - will be its own count
attend_count <- str_count(data$attend[data$attend != "It's my first year!" &
                                        data$attend != "Omitted"], ",")
virgins <- sum(data$attend == "It's my first year!")

count_0 <- sum(attend_count == 0)
count_1_2 <- sum(attend_count %in% c(1, 2))
count_3_6 <- sum(attend_count %in% c(3, 4, 5, 6))
count_7_or_more <- sum(attend_count >= 7)

# create a new data frame
attend_count_df <- data.frame(attendance = c("0","1", "2-3", "4-7", "8 or more"), 
                              count = c(virgins, count_0, count_1_2, count_3_6, count_7_or_more))
attend_count_df$percent <- attend_count_df$count / sum(attend_count_df$count) * 100
attend_count_df$percent_round <- round(attend_count_df$percent, digits = 1)
```


```{r gender data clean for 2024}
# cleaning up manual entries for gender in 2024 data
data_2024$q6_6_text <- gsub("Woof|Potato Farmer", "Omitted", 
                             data_2024$q6_6_text)
data_2024$q6_6_text <- sub("Two-spirited trans", "Gender fluid", 
                            data_2024$q6_6_text)
data_2024$q6_6_text <- gsub("Queer|Gender Queer", "Non-binary / third gender",
                            data_2024$q6_6_text)
data_2024$q6_6_text <- sub("Gender fluid ", "Gender fluid", 
                            data_2024$q6_6_text)

# replace "other" entry with the what was entered manually
data_2024$gender <- str_replace(data_2024$gender, "Other", data_2024$q6_6_text)
```

```{r orientation data clean 2024}
data_2024$q7_7_text <- gsub("Yes|Am Dog", "Omitted",
                            data_2024$q7_7_text)

# replace "other" entry with the what was entered manually
data_2024$orientation <- str_replace(data_2024$orientation, "Other:", data_2024$q7_7_text)
```

```{r relationship data clean 2024}
data_2024$q8_6_text <- sub("Slut","Omitted",
                            data_2024$q8_6_text)
data_2024$q8_6_text <- gsub("Relationship Anarchy|Relationship anarchy|Relationship Anarchist|Relationship anarachist",
                            "Relationship anarchist",
                            data_2024$q8_6_text)
data_2024$q8_6_text <- gsub("Whatever makes sense for the relationship|Spectrum|Relationship Fluid|Fluid",
                            "Relationship fluid",
                            data_2024$q8_6_text)
data_2024$q8_6_text <- sub("Complicated","Unsure/Questioning",
                            data_2024$q8_6_text)


# replace "other" entry with the what was entered manually
data_2024$relationship <- str_replace(data_2024$relationship, "Other", data_2024$q8_6_text)
```

```{r religion data clean 2024}
data_2024$q9_8_text <- gsub("Rastafarian|Pagan|Discordian",
                            "Religious",
                            data_2024$q9_8_text)
data_2024$q9_8_text <- gsub("Spiritual Omniest|Cosmic Agent",
                            "Spiritual",
                            data_2024$q9_8_text)
data_2024$q9_8_text <- sub("Nialist", "None",
                           data_2024$q9_8_text)
data_2024$q9_8_text <- gsub("Antitheist|Anti theist",
                            "Atheist",
                            data_2024$q9_8_text)
data_2024$q9_8_text <- sub("Militant agnostic", "Agnostic",
                           data_2024$q9_8_text)


# replace "other" entry with the what was entered manually
data_2024$religion <- str_replace(data_2024$religion, "Other", data_2024$q9_8_text)
```

```{r politics data clean 2024}
data_2024$q10_8_text <- sub("Socialist, Anarchist, Democratic Socialist", "Socialist,Anarchist,Democratic Socialist",
                            data_2024$q10_8_text)
data_2024$q10_8_text <- sub("Leftist, Socialist, Anarchist", "Leftist,Socialist,Anarchist",
                            data_2024$q10_8_text)
data_2024$q10_8_text <- gsub("The Best Choice|Dog|Mine?|Local politics and community work|Non- citizen",
                             "Omitted",
                             data_2024$q10_8_text)
data_2024$q10_8_text <- sub("Voting for Biden tho obvi",
                            "Democrat",
                            data_2024$q10_8_text)
data_2024$q10_8_text <- sub("Socialism", "Socialist",
                            data_2024$q10_8_text)

data_2024$q10_8_text <- sub("anarchist", "Anarchist",
                            data_2024$q10_8_text)

data_2024$q10_8_text <- gsub("Left|Far left|Leftist",
                             "Leftist",
                             data_2024$q10_8_text)

# replace "other" entry with the what was entered manually
data_2024$politics <- str_replace(data_2024$politics, "Other", data_2024$q10_8_text)
```

```{r info data clean 2024}
data_2024$q24_9_text <- sub("Lead mtgs / Slack", "SOAK volunteer group,Word of mouth",
                            data_2024$q24_9_text)
data_2024$q24_9_text <- gsub("White Bird|Rangers mailing list|Rangers E11|MBS volunteer emails|Leads meeting|GPE discord|Discord Rangers|Critical comms|Safety Northwest|Volunteering", "SOAK volunteer group",
                            data_2024$q24_9_text)
data_2024$q24_9_text <- gsub("Slack|Discord|Camp Slack|Camp Leads",
                             "Word of mouth",
                             data_2024$q24_9_text)

# replace "other" entry with the what was entered manually
data_2024$info <- str_replace(data_2024$info, "Other", data_2024$q24_9_text)
```

```{r race data clean 2024}
# replace "other" entry with the what was entered manually
data_2024$race <- str_replace(data_2024$race, "Other", data_2024$q3_9_text)
```

```{r language data clean 2024}
# replace "other" entry with the what was entered manually
data_2024$language <- str_replace(data_2024$language, "Other", data_2024$q5_12_text)
```

```{r data cleaning 2024}
# replace blanks with Omitted
data_2024[data_2024 == ""] <- "Omitted"
```

```{r attendance 2024}
# rows (sometimes) store several year
# pull them out and separate years so they can be counted individually
attend_list_24 <- strsplit(data_2024$attend, ",")
attend_unlist_24 <- unlist(attend_list_24)
occurrences_24 <- table(attend_unlist_24)
occurrences_df_24 <- as.data.frame(occurrences_24)

# get attendance count
# counting using commas - 0 commas per row means only have attended once, 1 comma = twice, etc.
# exclude virgins - will be its own count
attend_count_24 <- str_count(data_2024$attend[data_2024$attend != "It's my first year!" &
                                        data_2024$attend != "Omitted"], ",")
virgins_24 <- sum(data_2024$attend == "It's my first year!")

count_0_ <- sum(attend_count_24 == 0)
count_1_2_ <- sum(attend_count_24 %in% c(1, 2))
count_3_6_ <- sum(attend_count_24 %in% c(3, 4, 5, 6))
count_7_or_more_ <- sum(attend_count_24 >= 7)

# create a new data frame
attend_count_df_24 <- data.frame(attendance_24 = c("0","1", "2-3", "4-7", "8 or more"), 
                              count_24 = c(virgins_24, count_0_, count_1_2_, count_3_6_, count_7_or_more_))
attend_count_df_24$percent_24 <- attend_count_df_24$count_24 / sum(attend_count_df_24$count_24) * 100
attend_count_df_24$percent_round_24 <- round(attend_count_df_24$percent, digits = 1)
```

```{r combine attendance data frames}
attend_count_df <- cbind(attend_count_df, attend_count_df_24)
attend_count_df <- subset(attend_count_df, select = -attendance_24)
```

```{r remove extra data frame}
rm(attend_count_df_24)
```

```{r plot attendance 2024}
# plot which years were reported attended
occurrences_df_24 %>% 
  ggplot(aes(x = attend_unlist_24,
             y = Freq)) +
  geom_bar(stat = "identity",
           color = "black",
           fill = "turquoise") +
  labs(x = "Year attended",
       y = "Number of participants",
       title = "\nHow many participants were at which years") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        plot.margin = unit(c(0.5, 0.5, 0.5, 0.5), "cm"),  # Tighter plot margins
        axis.title.x = element_text(vjust = -0.5),   # Adjust x-axis label spacing
        axis.title.y = element_text(vjust = 0.5),
        panel.border = element_rect(color = "black", fill = NA, size = 0.5))
```

Were you there in 2008? What about last year? While only 14 surveyed folks were at 2008 SOAK, a total of 376 participants (40.6% of participants) reported 2024 as their first time attending SOAK, which is a decrease from 2023 which had 43.2% of the population report themselves as first timers. In 2023, Burning Man's population of first timers was 43.9% [according to their Census report](https://blackrockcitycensus.org/sociodemo).

``` {r attend bars 2024}
# redundant plot, excluding for 2024

# # plot how many years attended
# attend_count_df %>%
#   ggplot(aes(x = attendance, y = count_24, fill = count_24)) +
#   geom_bar(stat = "identity", color = "black", alpha = 0.8) +
#   labs(x = "Number of trips to SOAK",
#        y = "Number of participants",
#        title = "\n\n\nHow many times participants have previously attended SOAK",
#        caption = "Plot excludes omitted responses") +
#   geom_text(aes(label = count_24), 
#             position = position_stack(vjust = 0.5), 
#             size = 3.5, color = "black") +
#   guides(fill = FALSE) + #remove legend
#   theme_minimal() +
#   theme(plot.margin = unit(c(0.5, 0.5, 0.5, 0.5), "cm"),  # Tighter plot margins
#         axis.title.x = element_text(vjust = -0.5),   # Adjust x-axis label spacing
#         axis.title.y = element_text(vjust = 0.5),
#         panel.border = element_rect(color = "black", fill = NA, size = 0.5))
```

```{r pie chart 2024}
# create variable of participants used instead of hard coding value in chart
participants <- sum(attend_count_df$count_24)

# maths for pie chart
pie_labels <- attend_count_df %>% 
  mutate(csum = rev(cumsum(rev(percent_round_24))),
         pos = percent_round_24/2 + lead(csum, 1),
         pos = if_else(is.na(pos), percent_round_24/2, pos))

# the plot
attend_count_df %>% 
  ggplot(aes(x = "", y = percent_round_24, fill = fct_inorder(attendance))) +
  geom_col(width = 1, color = 1) +
  coord_polar(theta = "y") +
  scale_fill_brewer(palette = "Pastel2") +
  geom_label_repel(data = pie_labels,
                   aes(y = pos, label = paste0(percent_round_24, "%")),
                   size = 4.5, nudge_x = 1, show.legend = FALSE) +
  guides(fill = guide_legend(title = "Previous years attended")) +
  ggtitle("\n\n\nAttendance history") +
  labs(caption = paste(participants, "participants, excluding omitted responses \n")) +
  theme_void() +
  theme(panel.border = element_rect(color = "black", fill = NA, size = 0.5))
```

```{r attend long}
# Reshape the data into long format
attend_long <- attend_count_df %>%
  pivot_longer(cols = c("percent", "percent_24"), 
               names_to = "year", 
               values_to = "percent") %>%
  mutate(year = recode(year, "percent" = "2023", "percent_24" = "2024"))
```

``` {r longitudinal attendance}
# Create spaghetti plot
attend_long %>% 
  ggplot(aes(x = year, y = percent, group = attendance, color = attendance)) +
  geom_line(size = 1) +
  geom_point(size = 3) +  # Optional, to emphasize points
  labs(title = "Attendance change over time",
       x = "Year",
       y = "Percentage",
       color = "How many times \nattended before 2024") +
  theme_minimal() +
  scale_x_discrete(expand = c(0.2, 0)) +  # Control x-axis padding
    theme(
          plot.margin = unit(c(0.5, 0.5, 0.1, 0.5), "cm"),  # Tighter plot margin
          axis.title.x = element_text(vjust = -0.5),   # Adjust x-axis label spacing
          axis.title.y = element_text(vjust = 0.5),    # Adjust y-axis label spacing
          axis.text.x = element_text(angle = 45, hjust = 1), # Rotate x-axis labels if needed
          axis.ticks.length = unit(-0.15, "cm"),            # Move ticks closer to axis
          panel.border = element_rect(color = "black", fill = NA, size = 0.5),
          panel.spacing = unit(0.1, "lines"))
```

Here we see the total percent of participants who were first timers compared to returning for 1, 2 to 3, 4 to 7, or 8+ times. The line plot demonstrates the changes in each attendance category over one year.

```{r attend table}
# table showing stats instead of chart
subset_attend <- attend_count_df[, c('attendance','count','percent_round','count_24','percent_round_24')]

colnames(subset_attend)[1] <- "Previous years attended"
colnames(subset_attend)[2] <- "Count"
colnames(subset_attend)[3] <- "Percent"
colnames(subset_attend)[4] <- "Count"
colnames(subset_attend)[5] <- "Percent"
```

```{r}
subset_attend %>% 
  kbl(caption = if (knitr::is_html_output()) {
      "<span style='font-size: 16px;'>How many years have you attended SOAK?</span>"
    } else if (knitr::is_latex_output()) {
      "\\textbf{\\large How many years have you attended SOAK?}"
    }) %>%
  add_header_above(c(" " = 1, "2023" = 2, "2024" = 2)) %>% 
  kable_classic() %>% 
  kable_styling(latex_options = "H")
```
<br>

[According to the Burning Man Census Report](https://blackrockcitycensus.org/), its population had 28.3% first-time burners in 2022, with an increase to 43.9% first-timers in 2023, in comparison to SOAK's 43.2% fist-time SOAKers in 2023 and a slight decrease to 40.6% in 2024.
<br>

# Sociodemographic Characteristics

## Age and Gender

### Age

```{r age}
# create df counting the number of participants in each age group for 2023
age_counts <- table(data$age)
age <- as.data.frame(age_counts)
age$Var1 <- factor(age$Var1, levels = c("Under 13", "13-17", "18-24",
                                        "25-34", "35-44", "45-54", "55-64",
                                        "Over 65", "Omitted"))
age$Percent <- round((age$Freq / sum(age$Freq) * 100), digits = 1)

age_counts_24 <- table(data_2024$age)
age_24 <- as.data.frame(age_counts_24)
age_24$Var1 <- factor(age_24$Var1, levels = c("Under 13", "13-17", "18-20",
                                              "21-24", "25-34", "35-44", "45-54", "55-64",
                                              "Over 65", "Omitted"))
age_24$Percent <- round((age_24$Freq / sum(age_24$Freq) * 100), digits = 1)
```

```{r age plot}
# plot ages
age_24 %>% 
  ggplot(aes(x = Var1,
             y = Freq,
             fill = Var1)) +
  geom_bar(stat = "identity",
           color = "black") +
  scale_fill_brewer(name = "Age ranges",
                    palette = "RdYlGn") +
  labs(x = "Age range",
       y = "Number of participants",
       title = "\nAge of participants") +
  theme_minimal() +
    theme(legend.position = "none",
          plot.margin = unit(c(0.5, 0.5, 0.5, 0.5), "cm"),  # Tighter plot margin
          axis.title.x = element_text(vjust = -0.5),   # Adjust x-axis label spacing
          axis.title.y = element_text(vjust = 0.5),    # Adjust y-axis label spacing
          axis.text.x = element_text(angle = 45, hjust = 1), # Rotate x-axis labels if needed
          panel.border = element_rect(color = "black", fill = NA, size = 0.5)
  )
```

```{r longitudinal age}
# Create a new row with NA values
new_row <- data.frame(Var1 = NA, Freq = NA, Percent = NA)

# Insert the new row at the second index
age <- rbind(age[1, ], new_row, age[-1, ])

ages_df <- cbind(age, age_24)
#attend_count_df <- subset(attend_count_df, select = -attendance_24)

colnames(ages_df)[1] <- "Age group"
colnames(ages_df)[2] <- "2023 Count"
colnames(ages_df)[3] <- "2023 Percent"
colnames(ages_df)[4] <- "Age group 2024"
colnames(ages_df)[5] <- "2024 Count"
colnames(ages_df)[6] <- "2024 Percent"
```

```{r age table}
# table showing stats instead of chart
subset_age <- ages_df[, c('Age group', '2023 Percent', "Age group 2024", "2024 Percent")]
```

```{r arranging age}
# custom ranking order to ensure "Under 13" is first and "Omitted" is last
subset_age_reordered <- ages_df %>%
  mutate(order_rank = case_when(
    `Age group` == "Under 13" ~ 1,       # "Under 13" is ranked first
    `Age group` == "Omitted" ~ 3,        # "Omitted" is ranked last
    TRUE ~ 2                            # All other rows are ranked in the middle
  )) %>%
  arrange(order_rank) %>%               # Order by custom rank
  select(-order_rank)                   # Remove the ranking column
```

```{r age columns}
colnames(subset_age_reordered)[1] <- "Age group"
colnames(subset_age_reordered)[2] <- "Count"
colnames(subset_age_reordered)[3] <- "Percent"
colnames(subset_age_reordered)[4] <- "Age group"
colnames(subset_age_reordered)[5] <- "Count"
colnames(subset_age_reordered)[6] <- "Percent"
```

```{r kable fancy age}
subset_age_reordered %>% 
  kbl(caption = if (knitr::is_html_output()) {
      "<span style='font-size: 16px;'>Age range</span>"
    } else if (knitr::is_latex_output()) {
      "\\textbf{\\large Age range}"
    }, 
      row.names = FALSE) %>% 
  add_header_above(c("2023" = 3, "2024" = 3)) %>%  # Ensure 6 columns (3 for 2023, 2 for 2024)
  kable_classic() %>% 
  kable_styling(latex_options = "H")
```
<br>

In 2024, the majority of participants were between ages 25 and 44. Ages 35-44 were the highest reported age. Most age groups remained similar from 2023 to 2024, but there was a decrease in participants ages 25-34, increase in participants in ages 35-44, and an increase in participants ages 45-54. 

The survey changed from 2023 to 2024, by breaking the 18-24 age group into 2 subets: 18-20 and 21-24, thus we do not have an exact comparison for these ranges from year to year.

When compared to [the Burning Man Census Report](https://blackrockcitycensus.org/sociodemo#age),in 2023 the age of 36 is in the 50th percentile of ages. Between SOAK and the big burn, our age groups are distributed similarly.

### Gender Identity

```{r gender, include=FALSE}
data$gender_updated <- ifelse(grepl(",", data$gender), "Multiple identities", data$gender)
age_gender_counts <- table(data$age, data$gender_updated)
age_gender_counts_df <- as.data.frame(age_gender_counts)
colnames(age_gender_counts_df) <- c("age", "gender", "count")

# drop counts of 0 and omitted responses
age_gender_filtered_df <- age_gender_counts_df[age_gender_counts_df$count != 0, ]
age_gender_filtered_df <- age_gender_filtered_df[age_gender_filtered_df$age != "Omitted", ]
age_gender_filtered_df <- age_gender_filtered_df[age_gender_filtered_df$gender != "Omitted", ]
```

```{r, include=FALSE}
genders <- table(data$gender_updated)
genders <- as.data.frame(genders)
genders$percent <- round((genders$Freq / sum(genders$Freq) * 100), digits = 1)
```


```{r, include=FALSE}
# renaming columns
new_names <- c("Gender identity", "Count", "Percent")
colnames(genders) <- new_names
```

```{r gender 2024 start}
# rows (sometimes) store several responses
# pull them out and separate so reporting can be counted individually
gender_24_list <- strsplit(data_2024$gender, ",")
gender24_unlist <- unlist(gender_24_list)
gender24_occurrences <- table(gender24_unlist)
gender24_occurrences_df <- as.data.frame(gender24_occurrences)
```

```{r}
#replace entries with multiple responses with that
data_2024$gender[str_detect(data_2024$gender, ",")] <- "Multiple responses"
```

```{r}
gender_counts <- table(data_2024$gender)

# calculate percentages
gender24_percentages <- round(prop.table(gender_counts) * 100, 1)


gen24_df <- data.frame(
  Name = names(gender24_percentages),
  Count = as.numeric(gender_counts),
  Percent = gender24_percentages
)

gen24_df <- subset(gen24_df, select = -Percent.Var1)
```

```{r}
# maths for pie chart
gender_pie_labels <- gen24_df %>%
  mutate(csum = rev(cumsum(rev(Percent.Freq))),
         pos = Percent.Freq/2 + lead(csum, 1),
         pos = if_else(is.na(pos), Percent.Freq/2, pos))
```

```{r, echo=FALSE}
# the plot
gen24_df %>%
  ggplot(aes(x = "", y = Percent.Freq, fill = fct_inorder(Name))) +
  geom_col(width = 1, color = 1) +
  coord_polar(theta = "y") +
  scale_fill_brewer(palette = "Pastel2") +
  geom_label_repel(data = gender_pie_labels,
                   aes(y = pos, label = paste0(Percent.Freq, "%")),
                   size = 4.5, nudge_x = 1, show.legend = FALSE) +
  guides(fill = guide_legend(title = "Gender")) +
  ggtitle("\n\n\nGender identity") +
  labs(caption = paste(sum(gen24_df$Count), "participants, including omitted responses")) +
  theme_void()
```

```{r}
colnames(gender24_occurrences_df) <- c("Gender", "Count")
gender24_occurrences_df$Percent <- round((gender24_occurrences_df$Count / sum(gender24_occurrences_df$Count) * 100), digits = 1)
```

```{r}
genders <- as.data.frame(genders)

# Create a new row of NA values
new_row <- as.data.frame(matrix(NA, nrow = 1, ncol = ncol(genders)))
colnames(new_row) <- colnames(genders)

# Insert the new row at the 7th position
genders <- rbind(genders[1:6, ], new_row, genders[7:nrow(genders), ])
```

```{r}
gender_df <- cbind(genders, gen24_df)
```

```{r gender long}
# Reshape the data into long format
gender_long <- gender_df %>%
  pivot_longer(cols = c("Percent", "Percent.Freq"), 
               names_to = "year", 
               values_to = "percent") %>%
  mutate(year = recode(year, "Percent" = "2023", "Percent.Freq" = "2024"))
```


```{r}
gender_long <- gender_long[, !(colnames(gender_long) %in% c("Count", "Gender identity"))]
```

```{r}
colnames(gender_long)[colnames(gender_long) == "Name"] <- "gender"
```

```{r}
gender_long$percent[11] <- NA
```

``` {r longitudinal gender}
# Create spaghetti plot
gender_long %>% 
  filter(gender != "Omitted") %>% 
  ggplot(aes(x = year, y = percent, group = gender, color = gender)) +
  geom_line(size = 1) +
  geom_point(size = 3) +  # Optional, to emphasize points
  labs(title = "Gender identity change over time",
       x = "Year",
       y = "Percentage",
       color = "Gender") +
  theme_minimal() +
  scale_x_discrete(expand = c(0.2, 0)) +  # Control x-axis padding
    theme(
          plot.margin = unit(c(0.5, 0.5, 0.1, 0.5), "cm"),  # Tighter plot margin
          axis.title.x = element_text(vjust = -0.5),   # Adjust x-axis label spacing
          axis.title.y = element_text(vjust = 0.5),    # Adjust y-axis label spacing
          axis.text.x = element_text(angle = 45, hjust = 1), # Rotate x-axis labels if needed
          axis.ticks.length = unit(-0.15, "cm"),            # Move ticks closer to axis
          panel.border = element_rect(color = "black", fill = NA, size = 0.5),
          panel.spacing = unit(0.1, "lines"))
```

Most reported genders were stable between 2023 and 2024. In 2024, we added the option to select trans-man and trans-woman, which accounted for 2.2% of all participants. Men accounted for most participants at 43.7%, followed by women at 38.2%.

```{r}
colnames(gender_df)[1] <- "Gender1"
colnames(gender_df)[2] <- "Count1"
colnames(gender_df)[3] <- "Percent"
colnames(gender_df)[4] <- "Gender2"
colnames(gender_df)[5] <- "Count2"
colnames(gender_df)[6] <- "Percent24"
```

```{r}
gender_df <- gender_df %>% 
  arrange(desc(Percent24))
```

```{r}
colnames(gender_df)[1] <- "Gender"
colnames(gender_df)[2] <- "Count"
colnames(gender_df)[3] <- "Percent"
colnames(gender_df)[4] <- "Gender"
colnames(gender_df)[5] <- "Count"
colnames(gender_df)[6] <- "Percent"
```

```{r kable gender}
gender_df %>% 
  kbl(caption = if (knitr::is_html_output()) {
      "<span style='font-size: 16px;'>Gender identity</span>"
    } else if (knitr::is_latex_output()) {
      "\\textbf{\\large Gender identity}"
    }, 
    row.names = FALSE) %>% 
  add_header_above(c("2023" = 3, "2024" = 3)) %>%  # Ensure 6 columns (3 for 2023, 2 for 2024)
  kable_classic() %>% 
  kable_styling(latex_options = "H")
```

The above table is organized in descending order based on 2024's Percent column. According to [World Population Review](https://worldpopulationreview.com/state-rankings/transgender-population-by-state), while Oregon in 2024 had a transgender population of 0.47%, SOAK welcomed 2.2% transgender folks.

# Income and Education

### Education

```{r education and income wrangling 2023, include=FALSE}
# replace blank cells with omitted in these categories
data$edu[data$edu == ""] <- "Omitted"
data$income[data$income ==""] <- "Omitted"

edu <- table(data$edu)
edu <- as.data.frame(edu)
colnames(edu) <- c("edu", "count")
edu$percent <- round((edu$count / sum(edu$count) * 100), digits = 1)

# order for the plot
desired_edu_order <- c("Some K-12","High school (diploma or GED)","Some college","Associates",
                       "Vocational/trade","Bachelors", "Masters", "Doctoral","None","Omitted")

# convert the "edu" column to a factor with the desired order
edu$edu <- factor(edu$edu, levels = desired_edu_order)

income <- table(data$income)
income <- as.data.frame(income)
colnames(income) <- c("income", "count")
income$percent <- round((income$count / sum(income$count) * 100), digits = 1)

desired_income_order <- c("Less than $12,880","$12,880 - 24,999","$25,000 - 49,999",
                          "$50,000 - 74,999","$75,000 - 99,999","$100,000 - 149,999", 
                          "$150,000 - 199,999", "Above $200,000","Omitted")

# Convert the "edu" column to a factor with the desired order
income$income <- factor(income$income, levels = desired_income_order)
```

```{r correct education with multiple responses, include=FALSE}
# find indices of entries with commas in data_2024$edu
comma_entries <- grep(",", data_2024$edu)
data_2024$edu[comma_entries]
```

```{r education change to highest level, include=FALSE}
# replace specific entries in data_2024$edu
data_2024$edu <- ifelse(data_2024$edu == "Associates,Bachelors", "Bachelors",
                  ifelse(data_2024$edu == "High school (diploma or GED),Vocational/trade", "Vocational/trade",
                  ifelse(data_2024$edu == "Some college,Associates", "Associates",
                  ifelse(data_2024$edu == "Vocational/trade,Bachelors", "Bachelors",
                  ifelse(data_2024$edu == "Vocational/trade,Some college", "Vocational/trade",
                         data_2024$edu)))))
```

```{r education and income wrangling 2024, include=FALSE}
edu24 <- table(data_2024$edu)
edu24 <- as.data.frame(edu24)
colnames(edu24) <- c("edu", "count")
edu24$percent <- round((edu24$count / sum(edu24$count) * 100), digits = 1)

# order for the plot
desired_edu_order <- c("Some K-12","High school (diploma or GED)","Some college","Associates",
                       "Vocational/trade","Bachelors", "Masters", "Doctoral","None","Omitted")

# convert the "edu" column to a factor with the desired order
edu24$edu <- factor(edu24$edu, levels = desired_edu_order)

income_24 <- table(data_2024$income)
income_24 <- as.data.frame(income_24)
colnames(income_24) <- c("income", "count_24")
income_24$percent_24 <- round((income_24$count_24 / sum(income_24$count_24) * 100), digits = 1)

desired_income_order <- c("Less than $12,880","$12,880 - 24,999","$25,000 - 49,999",
                          "$50,000 - 74,999","$75,000 - 99,999","$100,000 - 149,999", 
                          "$150,000 - 199,999", "Above $200,000","Omitted")

# Convert the "edu" column to a factor with the desired order
income_24$income <- factor(income_24$income, levels = desired_income_order)
```

```{r education plots, echo=FALSE, warning=FALSE, message=FALSE}
colnames(edu24) <- sapply(colnames(edu24), function(x) paste(toupper(substr(x, 1, 1)), 
                                                           substr(x, 2, nchar(x)), sep = ""))
edu24 %>% 
  ggplot(aes(x = Edu, y = Percent)) +
  geom_bar(stat = "identity", color = "black", fill = "darkgray") +
  labs(x = "Level of education completed",
       y = "SOAK participants in 2024 (%)",
       title = "\n\nHighest level of education completed") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        panel.border = element_rect(color = "black", fill = NA, size = 0.5)) +
  scale_x_discrete(labels = c("Some K-12","High school","Some college","Associates",
                       "Vocational/trade","Bachelors", "Masters", "Doctoral",
                       "None","Omitted"))
```

In 2024, the number of advanced degrees (masters, doctoral) increased more than any other category. As our average population age also increased, this advancement in education follows logically.

```{r }
edu_combined <- cbind(edu, edu24)
edu_combined <- edu_combined[, -4]

edu_combined <- edu_combined %>%
  mutate(edu = factor(edu, levels = desired_edu_order)) %>%
  arrange(edu) # Reorder rows based on the desired order

colnames(edu_combined)[1] <- "Education"
colnames(edu_combined)[2] <- "Count"
colnames(edu_combined)[3] <- "Percent"
colnames(edu_combined)[4] <- "Count"
colnames(edu_combined)[5] <- "Percent"
```
<br>
```{r}
edu_combined %>% 
  kbl(caption = if (knitr::is_html_output()) {
      "<span style='font-size: 16px;'>Educational attainment</span>"
    } else if (knitr::is_latex_output()) {
      "\\textbf{\\large Educational attainment}"
    }) %>%
  add_header_above(c(" " = 1, "2023" = 2, "2024" = 2)) %>% 
  kable_classic() %>% 
  kable_styling(latex_options = "H")
```
<br>

According to data pulled from the [US Census Bureau](https://fred.stlouisfed.org/graph/?g=1CUwr), in 2023 37.7% of Oregonians attained a Bachelor's Degree or Higher. In 2023, [49.2% of Burners had Bachelor's degrees](https://blackrockcitycensus.org/sociodemo#highest-level-of-education-completed).


### Income

``` {r income plots}
colnames(income) <- sapply(colnames(income), function(x) paste(toupper(substr(x, 1, 1)), 
                                                           substr(x, 2, nchar(x)), sep = ""))

income_24 %>% 
  ggplot(aes(x = income, y = percent_24)) +
  geom_bar(stat = "identity", color = "black", fill = "darkgreen", alpha = 0.7) +
  labs(x = "Income",
       y = "Participants (%)",
       title = "\n\nPersonal income over the last 12 months in 2024") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        panel.border = element_rect(color = "black", fill = NA, size = 0.5))
```

```{r longitudinal income}
# combine income dfs
income_combined <- cbind(income, income_24)
income_combined <- income_combined[, -4]
```

```{r long income}
# Reshape the data into long format
income_long <- income_combined %>%
  pivot_longer(cols = c("Percent", "percent_24"), 
               names_to = "year", 
               values_to = "percent") %>%
  mutate(year = recode(year, "Percent" = "2023", "percent_24" = "2024"))
```

``` {r longitudinal income plot, echo=F}
# Create spaghetti plot
income_long %>% 
  filter(Income != "Omitted") %>% 
  ggplot(aes(x = year, y = percent, group = Income, color = Income, shape = Income)) +
  geom_line(size = 1) +
  geom_point(size = 3) +  # Optional, to emphasize points
  labs(title = "Personal income pre-tax in the last 12 months",
       x = "Year",
       y = "Total particpants (%)",
       color = "Income",
       shape = "Income") +
  theme_minimal() +
  scale_color_brewer(palette = "BrBG") +
  scale_x_discrete(expand = c(0.2, 0)) +  # Control x-axis padding
    theme(
          plot.margin = unit(c(0.5, 0.5, 0.1, 0.5), "cm"),  # Tighter plot margin
          axis.title.x = element_text(vjust = -0.5),   # Adjust x-axis label spacing
          axis.title.y = element_text(vjust = 0.5),    # Adjust y-axis label spacing
          axis.text.x = element_text(angle = 45, hjust = 1), # Rotate x-axis labels if needed
          axis.ticks.length = unit(-0.15, "cm"),            # Move ticks closer to axis
          panel.border = element_rect(color = "black", fill = NA, size = 0.5),
          panel.spacing = unit(0.1, "lines"))
```

The most commonly reported income in 2024 was $25,000-49,999.
The largest change in 2024 was the income bracket of $12,880-24,999, which decreased by 4.1%. The distribution of incomes is fairly even in the middle brackets, with lower values on the tails, as you would expect.

<br>
```{r reorder and rename columns for income}
# Reorder the "Income" column and rename the columns
income_combined_ordered <- income_combined %>%
  mutate(Income = factor(Income, levels = desired_income_order)) %>%
  arrange(Income)
```

```{r}
colnames(income_combined_ordered)[2] <- "Count"
colnames(income_combined_ordered)[3] <- "Percent"
colnames(income_combined_ordered)[4] <- "Count"
colnames(income_combined_ordered)[5] <- "Percent"
```

```{r}
income_combined_ordered %>% 
  kbl(caption = if (knitr::is_html_output()) {
      "<span style='font-size: 16px;'>Personal income pre-tax in previous 12 months</span>"
    } else if (knitr::is_latex_output()) {
      "\\textbf{\\large Personal income pre-tax in previous 12 months}"
    }) %>%
  add_header_above(c(" " = 1, "2023" = 2, "2024" = 2)) %>% 
  kable_classic() %>% 
  kable_styling(latex_options = "H")
```
<br>

According to the Oregon Secretary of State, the [per capita personal income in 2023 was $65,426](https://sos.oregon.gov/blue-book/Pages/facts/economy-income.aspx). To calculate the SOAK per capita income, we would need exact income amounts instead of ranges. Despite this, we can see the majority of participants earn within a bracket that would suggest our per capita is similar to or above Oregon.

### Residence

```{r zipcode }
library(zipcodeR)
```

``` {r zipcode data 2023, include=FALSE}
data("zip_code_db")

# manually add information for ZIP code 97003
new_info <- data.frame(zipcode = "97003", major_city = "Beaverton", state = "OR",
                       lat = 45.51, lng = -122.88)

# add the new information to zip_code_db
zip_code_db <- bind_rows(zip_code_db, new_info)

data$zip_code[data$zip_code == ""] <- NA
#52 rows omitted as NA

zip_codes <- table(data$zip_code)
zip_codes <- as.data.frame(zip_codes)
colnames(zip_codes) <- c("zipcode", "count")

zip_geos <- geocode_zip(data$zip_code)
zips_merged <- left_join(zip_codes, zip_geos, by = "zipcode")


# function to get city and state information for a given ZIP code
get_city_state_for_zip <- function(zipcode) {
  zip_info <- zip_code_db[zip_code_db$zipcode == as.character(zipcode), c("major_city", "state")]
  city <- ifelse(length(zip_info$major_city) > 0, zip_info$major_city, NA)
  state <- ifelse(length(zip_info$state) > 0, zip_info$state, NA)
  return(data.frame(City = city, State = state))
}

# apply the function to each unique zip code in zips_merged
zips_merged <- zips_merged %>%
  rowwise() %>%
  do(get_city_state_for_zip(.$zipcode)) %>%
  bind_cols(zips_merged, .)

# lat and lng of cities entered by df

zips_merged$City[9] <- "Duisburg"
zips_merged$State[9] <- "Germany"

zips_merged$lat[16] <- 33.21
zips_merged$lng[16] <- -97.13

zips_merged$City[30] <- "Anjoutey"
zips_merged$State[30] <- "France"

zips_merged$lat[70] <- 45.49
zips_merged$lng[70] <- -122.88

zips_merged$City[98] <- "Portland"
zips_merged$State[98] <- "OR"

zips_merged$City[108] <- "Portland"
zips_merged$State[108] <- "OR"

zips_merged$City[113] <- "Salem"
zips_merged$State[113] <- "OR"

zips_merged$lat[123] <- 43.4
zips_merged$lng[123] <- -124.03

zips_merged$City[125] <- "Schweinfurt"
zips_merged$State[125] <- "Germany"

zips_merged$lat[133] <- 44.06
zips_merged$lng[133] <- -121.34

zips_merged$City[141] <- "Seattle"
zips_merged$State[141] <- "WA"

zips_merged$lat[142] <- 47.68
zips_merged$lng[142] <- -122.21

zips_merged$City[193] <- "Sacramento"
zips_merged$State[193] <- "CA"
```

```{r states 2023, include=FALSE}
state_counts <- zips_merged %>%
  group_by(State) %>%
  summarize(Count = sum(count))

state_counts <- state_counts  %>%
  arrange(desc(Count))

state_counts <- na.omit(state_counts)
state_counts$Percent <- round((state_counts$Count / sum(state_counts$Count) * 100), digits = 1)

# knitr::kable(state_counts, row.names = FALSE)
```

```{r cities 2023, include=FALSE}
city_counts <- zips_merged %>%
  group_by(City) %>%
  summarize(Count = sum(count))

city_counts <- city_counts %>%
  arrange(desc(Count))

city_counts <- na.omit(city_counts)
city_counts$Percent <-  round((city_counts$Count / sum(city_counts$Count) * 100), digits = 1)

# knitr::kable(head(city_counts, 10))
```

```{r, include=FALSE}
# 2024 ZIP DATA

# Count empty zip codes
sum(data_2024$zip_code == "") # There are no empty zip codes
# Count "Omitted" zip codes
sum(data_2024$zip_code == "Omitted") # There are 56 "Omitted" zip codes

#data_2024$zip_code[data_2024$zip_code == "Omitted"] <- NA
#head(data_2024$zip_code)
#str_extract(head(data_2024$zip_code,30), '\\s*\\d{5}\\s*')

# Return all values that do not match 5-digit zipcode
data_2024$zip_code[!grepl('\\s*\\d{5}\\s*', data_2024$zip_code)]
# There are 63 that do not match.
# 7 Canadian Zipcodes, and 56 "Omitted"

# function to get city and state information for a given ZIP code
get_city_state_for_zip <- function(zipcode) {
  zip_info <- zip_code_db[zip_code_db$zipcode == as.character(zipcode), c("major_city", "state")]
  city <- ifelse(length(zip_info$major_city) > 0, zip_info$major_city, NA)
  state <- ifelse(length(zip_info$state) > 0, zip_info$state, NA)
  return(data.frame(City = city, State = state))
}

#2024 data includes:
# V5M 2E9 (two) - Vancouver, Canada
# V1W-3R4 - Kelowna, Canada (V1W 3R4)
# T2J5C5 - Calgary, Canada (T2J 5C5)
# Y1A 5M1 - Whitehorse, YT, Canada
# V6V1K4 - Richmond, Canada (V6V 1K4)
# v3g1e4 - Abbotsford, Canada (V3G 1E4)

#zip_codes from 2024
zip_codes_24 <- table(data_2024$zip_code)
zip_codes_24 <- as.data.frame(zip_codes_24)
colnames(zip_codes_24) <- c("zipcode", "count")

zip_geos_24 <- geocode_zip(data_2024$zip_code) # get latitude and longitude for zip codes
zips_merged_24 <- left_join(zip_codes_24, zip_geos_24, by = "zipcode") #combine data: zip, quantity, lat, lng


# 2024 zipcode data:
# apply the function to each unique 2024 zip code in zips_merged_24
zips_merged_24 <- zips_merged_24 %>%
  rowwise() %>%
  do(get_city_state_for_zip(.$zipcode)) %>%
  bind_cols(zips_merged_24, .)

 zips_merged_24[!complete.cases(zips_merged_24),]
```

```{r, include=FALSE}
# lat and lng of cities entered by TM

# 97402
zips_merged_24$City[1] <- "Eugene"
zips_merged_24$State[1] <- "OR"
zips_merged_24$lat[1] <- 44.03
zips_merged_24$lng[1] <- -123.25

#84009 South Jordan, UT
zips_merged_24$lat[27] <- 40.55
zips_merged_24$lng[27] <- -112.02

#87503 Santa Fe, NM
zips_merged_24$lat[31] <- 35.69
zips_merged_24$lng[31] <- -105.94

# Commenting out foreign zip codes to avoid outliers on US map
# # 89075 Ulm, Germany
zips_merged_24$City[33] <- "Ulm"
zips_merged_24$State[33] <- "Germany"
# zips_merged_24$lat[33] <- 48.42
# zips_merged_24$lng[33] <- 10.00

# Zip 89662 cannot be found
#zips_merged_24$City[37]
#zips_merged_24$State[37]
#zips_merged_24$lat[37]
#zips_merged_24$lng[37]

# 97003 Beaverton
zips_merged_24$City[64] <- "Beaverton"
zips_merged_24$State[64] <- "OR"
zips_merged_24$lat[64] <- 45.50
zips_merged_24$lng[64] <- -122.80

# 97078 Beaverton
zips_merged_24$lat[87] <- 45.48
zips_merged_24$lng[87] <- -122.89

#97207 Portland

zips_merged_24$lat[102] <- 45.52
zips_merged_24$lng[102] <- -122.68

#97404 Eugene
zips_merged_24$City[143] <- "Eugene"
zips_merged_24$State[143] <- "OR"
zips_merged_24$lat[143] <- 44.10
zips_merged_24$lng[143] <- -123.13

# 97602 Klamath Falls
zips_merged_24$lat[152] <- 42.23
zips_merged_24$lng[152] <- -121.78

# 97703 Bend
zips_merged_24$lat[155] <- 44.06
zips_merged_24$lng[155] <- -121.32

# 98062 Seahurst, WA
zips_merged_24$lat[167] <- 47.47
zips_merged_24$lng[167] <- -122.36

# 98161 Seattle, WA
zips_merged_24$lat[185] <- 47.60
zips_merged_24$lng[185] <- -122.33

# Commenting out foreign zip codes to avoid outliers on US map

# #98689 Vancouver, WA approximately
zips_merged_24$City[222] <- "Vancouver"
zips_merged_24$State[222] <- "WA"
zips_merged_24$lat[222] <- 45.74
zips_merged_24$lng[222] <- -122.63

# AK and HI NA coords for plotting
zips_merged_24$lat[63] <- NA
zips_merged_24$lng[63] <- NA
zips_merged_24$lat[228] <- NA
zips_merged_24$lng[228] <- NA

# # T2J5C5 Calgary, Canada
zips_merged_24$City[230] <- "Calgary"
zips_merged_24$State[230] <- "Canada"
# zips_merged_24$lat[230] <- 50.92
# zips_merged_24$lng[230] <- -114.02
#
# # V1W-3R4 - Kelowna, Canada
zips_merged_24$City[231] <- "Kelowna"
zips_merged_24$State[231] <- "Canada"
# zips_merged_24$lat[231] <- 49.86
# zips_merged_24$lng[231] <- 	-119.49
#
# # v3g1e4 - Abbotsford, Canada (V3G 1E4)
zips_merged_24$City[232] <- "Abbotsford"
zips_merged_24$State[232] <- "Canada"
# zips_merged_24$lat[232] <- 49.04
# zips_merged_24$lng[232] <- 	-122.23
#
# # V5M 2E9 - Vancouver, Canada
zips_merged_24$City[233] <- "Vancouver"
zips_merged_24$State[233] <- "Canada"
# zips_merged_24$lat[233] <- 49.26
# zips_merged_24$lng[233] <- 	-123.04
#
# # V6V1K4 - Richmond, Canada (V6V 1K4)
zips_merged_24$City[234] <- "Richmond"
zips_merged_24$State[234] <- "Canada"
# zips_merged_24$lat[234] <- 49.20
# zips_merged_24$lng[234] <- 	-123.08
#
# # Y1A 5M1 - Whitehorse, YT, Canada
zips_merged_24$City[235] <- "Whitehorse"
zips_merged_24$State[235] <- "Canada"
# zips_merged_24$lat[235] <- 60.77
# zips_merged_24$lng[235] <- 	-135.14

zips_merged_24[!complete.cases(zips_merged_24),]
# Check for remaining null or incomplete
```

```{r zip plot 2024, echo=FALSE}
zips_merged_24_clean <- na.omit(zips_merged_24)
usa_map <- map_data("state")

ggplot() +
  geom_polygon(data = usa_map, aes(x = long, y = lat, group = group), 
               fill = "white", color = "gray") +
  geom_point(data = zips_merged_24_clean, aes(x = lng, y = lat, size = count, color = count), 
             show.legend = TRUE) +
  scale_size_continuous(range = c(1, 10)) +
  scale_color_gradient(low = "blue", high = "red") +  # Set the color scale
  labs(title = "Zip code density map of 2024 SOAK attendees in the United States") +
  theme_minimal() +
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.title.x = element_blank(),
        axis.title.y = element_blank()) +
  guides(size = "none") +
  labs(color = "Zip code frequency") +
  coord_fixed(ratio = 1.5)
```

This density heat map shows the highest and lowest concentrations of residencies of SOAK participants. As expected, we see the hottest and largest areas in the Pacific Northwest.

```{r states 2024}
state_counts_24 <- zips_merged_24 %>%
  group_by(State) %>%
  summarize(Count = sum(count))

state_counts_24 <- state_counts_24  %>%
  arrange(desc(Count))

state_counts_24 <- na.omit(state_counts_24)
state_counts_24$Percent <- round((state_counts_24$Count / sum(state_counts_24$Count) * 100), digits = 1)

# knitr::kable(state_counts, row.names = FALSE)
```

```{r cities 2024}
city_counts_24 <- zips_merged_24 %>%
  group_by(City) %>%
  summarize(Count = sum(count))

city_counts_24 <- city_counts_24 %>%
  arrange(desc(Count))

city_counts_24 <- na.omit(city_counts_24)
city_counts_24$Percent <-  round((city_counts_24$Count / sum(city_counts_24$Count) * 100), digits = 1)

# knitr::kable(head(city_counts, 10))
```

```{r}
# Subset the top 15 rows from each data frame
state_counts_top10 <- state_counts %>% slice(1:15)
state_counts_24_top10 <- state_counts_24 %>% slice(1:15)

# Combine the two data frames side by side
combined_state <- cbind(state_counts_top10, state_counts_24_top10)
```

```{r}
# state table
combined_state %>% 
  kbl(caption = if (knitr::is_html_output()) {
      "<span style='font-size: 16px;'>State counts</span>"
    } else if (knitr::is_latex_output()) {
      "\\textbf{\\large State counts}"
    }) %>%
  add_header_above(c("2023" = 3, "2024" = 3)) %>% 
  kable_classic() %>%
  kable_styling(latex_options = "H")
```
<br>
<br>

The top 15 states of origin reported in 2023 and 2024. Oregon, Washington, California, and Idaho were the states most commonly reported. We also have Canada in our top 15 places of origin in 2024.
<br>

```{r}
# Subset the top 10 rows from each data frame
city_counts_top10 <- city_counts %>% slice(1:10)
city_counts_24_top10 <- city_counts_24 %>% slice(1:10)

# Combine the two data frames side by side
combined_city <- cbind(city_counts_top10, city_counts_24_top10)
```

```{r}
# city table
combined_city %>% 
  kbl(caption = if (knitr::is_html_output()) {
      "<span style='font-size: 16px;'>City counts (top 10)</span>"
    } else if (knitr::is_latex_output()) {
      "\\textbf{\\large City counts (top 10)}"
    }) %>%
  add_header_above(c("2023" = 3, "2024" = 3)) %>% 
  kable_classic() %>%
  kable_styling(latex_options = "H")
```
<br>

When looking at specific cities, the top 10 reported were in Oregon, Washington, and Idaho with Portland accounting for just over half (50.1%) of all responses. The top 4 cities have remained the same between 2023 and 2024, with Boise entering the top 10 to include Idaho for the first time.

# Ethnicity and Language

### Ethnicity
```{r race 23}
#For race, multiracial was an option and some participants selected multiple races. Replace those entries with multiracial
data$race_cleaned <- gsub(".*\\,.*", "Multiracial", data$race)

#replace entry of human with omitted
data$race_cleaned[data$race_cleaned == ""] <- "Omitted"
data$race_cleaned <- gsub("Human", "Omitted", data$race_cleaned)

for (i in 1:length(data$race_cleaned)) {
  if (grepl(":)", data$race_cleaned[i], fixed = TRUE)) {
    data$race_cleaned[i] <- "Omitted"
  }
}
```

```{r race 23 table }
race <- table(data$race_cleaned)
race <- as.data.frame(race)

colnames(race) <- c("race", "count")
race$percent <- round((race$count / sum(race$count) * 100), digits = 1)
```

```{r race 24}
race_24 <- gsub(".*\\,.*", "Multiracial", data_2024$race)
race_24 <- as.data.frame(race_24)
```

```{r}
race24 <- table(race_24)
race24<- as.data.frame(race24)
colnames(race24) <- c("Race", "Count")
race24$Percent <- round((race24$Count / sum(race24$Count) * 100), digits = 1)
```

```{r}
rm(race_24)
```

```{r}
race <- race %>% arrange(desc(percent))
race$race <- factor(race$race, levels = race$race)
```

```{r race plot }
race24 <- race24 %>% arrange(desc(Percent))
race24$Race <- factor(race24$Race, levels = race24$Race)

# Create the bar plot with reordered data
race24 %>%
  ggplot(aes(x = reorder(Race, -Percent), y = Percent)) +
  geom_bar(stat = "identity", color = "black", fill = "pink") +
  labs(
    x = "Ethnicity",
    y = "SOAK participants in 2024 (%)",
    title = "\n\nEthnoracial background"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

```{r }
# plotting table of values
colnames(race) <- sapply(colnames(race), function(x) paste(toupper(substr(x, 1, 1)),
                                                           substr(x, 2, nchar(x)), sep = ""))

```

```{r}
# merge the two tables
race_combined <- merge(race, race24, by = "Race", all = TRUE)
```

```{r}
colnames(race_combined) <- c("Race", "Count", "Percent", "Count", "Percent")
```

```{r race table}
race_combined %>% 
  kbl(caption = if (knitr::is_html_output()) {
      "<span style='font-size: 16px;'>Ethnicity (or race) you identify with</span>"
    } else if (knitr::is_latex_output()) {
      "\\textbf{\\large Ethnicity (or race) you identify with}"
    }) %>%
  add_header_above(c(" " = 1, "2023" = 2, "2024" = 2)) %>% 
  kable_classic() %>% 
  kable_styling(latex_options = "H")
```
<br>

The most common reported race was White or Caucasian, which is the same as in 2023. Generally, the reporting of race was consistent between years with a slight uptick in White. 

[According to Data USA](https://datausa.io/profile/geo/oregon#demographics), in 2022 Oregon's White population was 73.3%. Oregon's Hispanic population in 2022 was 13.8% compared to SOAK's 3.4%. Multiracial was categorized by non-Hispanic and Hispanic at 5.2% and 4.01%, respectively. Asian was 4.38% compared to SOAKs 3%, which was consistent between years.

### Birth Place

```{r birth place}
birth <- table(data$born)
birth <- as.data.frame(birth)

colnames(birth) <- c("response", "count")

birth$percent <- round((birth$count / sum(birth$count) * 100), digits = 1)

# birthplace table for the 2024 data
birth_2024 <- table(data_2024$born)
birth_2024 <- as.data.frame(birth_2024)
colnames(birth_2024) <- c("response", "count_24")

# percent for the 2024 data
birth_2024$percent_24 <- round((birth_2024$count_24 / sum(birth_2024$count_24) * 100), digits = 1)

# merge the two tables by the "response" column
birth_combined <- merge(birth, birth_2024, by = "response", all = TRUE)
```

```{r birth graph}
#maths for pie chart
pie_labels_birth <- birth_2024 %>% 
  mutate(csum = rev(cumsum(rev(percent_24))),
         pos = percent_24/2 + lead(csum, 1),
         pos = if_else(is.na(pos), percent_24/2, pos))

#the plot
birth_2024 %>% 
  ggplot(aes(x = "", y = percent_24, fill = fct_inorder(response))) +
  geom_col(width = 1, color = 1) +
  coord_polar(theta = "y") +
  scale_fill_brewer(palette = "Pastel2") +
  geom_label_repel(data = pie_labels_birth,
                   aes(y = pos, label = paste0(percent_24, "%")),
                   size = 4.5, nudge_x = 1, show.legend = FALSE) +
  guides(fill = guide_legend(title = "Response")) +
  ggtitle("\n\n\nWere you born in the US?") +
  labs(caption = paste(sum(birth_2024$count), "participants, including omitted responses \n")) +
  theme_void() +
  theme(panel.border = element_rect(color = "black", fill = NA, size = 0.5))
```

```{r birth renaming}
colnames(birth_combined) <- c("Response", "Count", "Percent", "Count", "Percent")
```

``` {r birth table}
birth_combined %>% 
  kbl(caption = if (knitr::is_html_output()) {
      "<span style='font-size: 16px;'>Were you born in the US?</span>"
    } else if (knitr::is_latex_output()) {
      "\\textbf{\\large Were you born in the US?}"
    }) %>%
  add_header_above(c(" " = 1, "2023" = 2, "2024" = 2)) %>% 
  kable_classic() %>% 
  kable_styling(latex_options = "H")
```
<br>

Most participants were born in the USA. In Oregon in 2023, [the foreign-born population was 9.6%](https://usafacts.org/answers/how-many-immigrants-are-in-the-us/state/oregon/) compared to SOAK's 8.5% foreign-born population in 2024, which was a decrease from 9.1% in 2023.

### Primary Language

```{r language wrangling 2023, include=FALSE}
# create df only containing language data
language_df <- data %>%
  select(language, q5_12_text)

# remove omitted response
language_df <- language_df %>%
  filter(language != "Omitted")

language_df <- language_df %>%
  na.omit(language_df)

# replace other entry with the language that was entered manually
language_df <- language_df %>%
  mutate(language = str_replace(language, "Other", q5_12_text))

# drop 2nd column
language_df <- language_df %>%
  select(-ncol(language_df))

# Count rows where language is "English" only
english_only_count <- sum(grepl("^English$", language_df$language, ignore.case = TRUE))

# Count rows where language contains "English" and other languages
english_with_other_count <- sum(grepl("English", language_df$language, ignore.case = TRUE) & !grepl("^English$", language_df$language, ignore.case = TRUE))

# Count rows where language does not contain "English"
non_english_count <- sum(!grepl("English", language_df$language, ignore.case = TRUE))

# Calculate percentages of languages spoken in relation to English
language_percent <- c(non_english_count/nrow(language_df)*100,
                      english_with_other_count/nrow(language_df)*100,
                      english_only_count/nrow(language_df)*100)

language_percent <- round(language_percent, 1)
language_percent_names <- c("Non-English", "English and 1+ language", "English")


# Create the data frame
language_percent_df <- data.frame(Language = language_percent_names, Percentage = language_percent)

```

```{r include=FALSE}
language_24 <- data_2024 %>%
  select(language)

# remove omitted response
language_24 <- language_24 %>%
  filter(language != "Omitted")

language_24 <- language_24 %>%
  na.omit(language_24)

# Count rows where language is "English" only
english_only_24 <- sum(grepl("^English$", language_24$language, ignore.case = TRUE))

# Count rows where language contains "English" and other languages
english_with_other_24 <- sum(grepl("English", language_24$language, ignore.case = TRUE) & !grepl("^English$", language_24$language, ignore.case = TRUE))

# Count rows where language does not contain "English"
non_english_24 <- sum(!grepl("English", language_24$language, ignore.case = TRUE))

# Calculate percentages of languages spoken in relation to English
language_percent_24 <- c(non_english_24/nrow(language_24)*100,
                      english_with_other_24/nrow(language_24)*100,
                      english_only_24/nrow(language_24)*100)

language_percent_24 <- round(language_percent_24, 1)
language_percent_names <- c("Non-English", "English and 1+ language", "English")


# Create the data frame
language_percent_df_24 <- data.frame(Language = language_percent_names, 
                                     Percentage = language_percent_24)
```

```{r echo=FALSE}
# Plot
language_percent_df_24 %>%
  ggplot(aes(x = Language, y = Percentage, fill = Language)) +
  geom_bar(stat = "identity", position = "stack", alpha = 0.9, color = "black") +
  geom_text(aes(label = sprintf("%.1f%%", Percentage)),
            position = position_stack(vjust = 0.5),
            size = 3, color = "black") +
  labs(title = "Language use by partcipants", x = "Language", y = "Percentage") +
  theme_minimal()
```

``` {r }
language_df_counts <- language_df %>%
  separate_rows(language, sep = ",") %>%
  group_by(language) %>%
  count()

# capitalize languages
language_df_counts <- language_df_counts %>%
  mutate(language = str_to_title(language))

colnames(language_df_counts) <- c("Language", "Count")
```

```{r}
language_df_counts_24 <- language_24 %>%
  separate_rows(language, sep = ",") %>%
  group_by(language) %>%
  count()

# capitalize languages
language_df_counts_24 <- language_df_counts_24 %>%
  mutate(language = str_to_title(language))

colnames(language_df_counts_24) <- c("Language", "Count")
```

```{r}
# Combine the two data frames side by side
combined_lang <- cbind(language_percent_df, language_percent_df_24)
```

```{r}
# language table
combined_lang %>% 
  kbl(caption = if (knitr::is_html_output()) {
      "<span style='font-size: 16px;'>Preferred language used</span>"
    } else if (knitr::is_latex_output()) {
      "\\textbf{\\large Preferred language used}"
    }) %>%
  add_header_above(c("2023" = 2, "2024" = 2)) %>% 
  kable_classic() %>%
  kable_styling(latex_options = "H")
```

```{r}
# Create 3 rows of NA with the same column names as the original data frame
na_rows <- data.frame(matrix(NA, nrow = 3, ncol = ncol(language_df_counts)))
colnames(na_rows) <- colnames(language_df_counts)

# Append the rows of NA to the original data frame
language_df_counts <- bind_rows(language_df_counts, na_rows)
```

```{r}
combined_all_lang <- cbind(language_df_counts, language_df_counts_24)
```

```{r}
colnames(combined_all_lang) <- c("Language", "Count", "Language", "Count")
```
<br>
Language use has remained stable between the years, with English being the most commonly used language by participants.

```{r}
# language table
combined_all_lang %>% 
  kbl(caption = if (knitr::is_html_output()) {
      "<span style='font-size: 16px;'>All languages reported</span>"
    } else if (knitr::is_latex_output()) {
      "\\textbf{\\large All languages reported}"
    }) %>%
  add_header_above(c("2023" = 2, "2024" = 2)) %>% 
  kable_classic() %>%
  kable_styling(latex_options = "H")
```

There is a growing number of languages used by SOAK participants, three more languages than in 2023.

<br><br>

### Accessibility Requirements

```{r ada}
ada <- table(data_2024$ada)
ada <- as.data.frame(ada)
colnames(ada) <- c("Response", "Count")
ada$Percent <- round((ada$Count / sum(ada$Count) * 100), digits = 1)
```

```{r ada pie}
#maths for pie chart
pie_labels_ada <- ada %>% 
  mutate(csum = rev(cumsum(rev(Percent))),
         pos = Percent/2 + lead(csum, 1),
         pos = if_else(is.na(pos), Percent/2, pos))

#the plot
ada %>% 
  ggplot(aes(x = "", y = Percent, fill = fct_inorder(Response))) +
  geom_col(width = 1, color = 1) +
  coord_polar(theta = "y") +
  scale_fill_brewer(palette = "PiYG") +
  geom_label_repel(data = pie_labels_ada,
                   aes(y = pos, label = paste0(Percent, "%")),
                   size = 4.5, nudge_x = 1, show.legend = FALSE) +
  guides(fill = guide_legend(title = "Response")) +
  ggtitle("\n\n\nDo you have accessibility requirements?") +
  labs(caption = paste(sum(ada$Count), "participants, including omitted responses \n")) +
  theme_void() +
  theme(panel.border = element_rect(color = "black", fill = NA, size = 0.5))
```

``` {r ada table}
ada %>% 
  kbl(caption = if (knitr::is_html_output()) {
      "<span style='font-size: 16px;'>Do you have accessibility requirements?</span>"
    } else if (knitr::is_latex_output()) {
      "\\textbf{\\large Do you have accessibility requirements?}"
    }) %>%
  add_header_above(c(" " = 1, "2024" = 2)) %>% 
  kable_classic() %>% 
  kable_styling(latex_options = "H")
```
<br>

### Military Status

```{r military status}
military <- table(data_2024$military)
military <- as.data.frame(military)

colnames(military) <- c("Status", "Count")

military$Percent <- round((military$Count / sum(military$Count) * 100), digits = 1)
```

```{r military pie}
#maths for pie chart
pie_labels_mil <- military %>% 
  mutate(csum = rev(cumsum(rev(Percent))),
         pos = Percent/2 + lead(csum, 1),
         pos = if_else(is.na(pos), Percent/2, pos))

#the plot
military %>% 
  ggplot(aes(x = "", y = Percent, fill = fct_inorder(Status))) +
  geom_col(width = 1, color = 1) +
  coord_polar(theta = "y") +
  scale_fill_manual(values = c("red", "white", "dodgerblue", "gray")) +
  geom_label_repel(data = pie_labels_mil,
                   aes(y = pos, label = paste0(Percent, "%")),
                   size = 4.5, nudge_x = 1, show.legend = FALSE) +
  guides(fill = guide_legend(title = "Military status")) +
  ggtitle("\n\n\nMilitary status of participants") +
  labs(caption = paste(sum(military$Count), "participants, including omitted responses \n")) +
  theme_void() +
  theme(panel.border = element_rect(color = "black", fill = NA, size = 0.5))
```

```{r military table}
military %>% 
  kbl(caption = if (knitr::is_html_output()) {
      "<span style='font-size: 16px;'>Military service</span>"
    } else if (knitr::is_latex_output()) {
      "\\textbf{\\large Military service}"
    }) %>%
  add_header_above(c(" " = 1, "2024" = 2)) %>% 
  kable_classic() %>% 
  kable_styling(latex_options = "H")
```
<br>

According to USA Facts, [Oregon's Veteran population in 2022 was 7.4%](https://usafacts.org/topics/veterans/state/oregon/), which is higher than the SOAK population. 

# Spirituality and Politics

### Political Party Affiliation
```{r religion and politics wrangling, include=FALSE}
# create df only containing rel and pol data
religion_politics <- data %>%
  select(religion, q9_8_text, politics, q10_8_text)

# for religion, many entries of other with specific religion listed instead of religious
# survey did not ask specifically for theistic vs non-theistic religion, simply religious
# replace specified spiritualities claimed as spiritual, otherwise religious
religion_politics <- religion_politics %>%
  mutate(religion = case_when(
    str_detect(q9_8_text, "Druidic|Hoodoo") ~ "Spiritual",
    TRUE ~ str_replace(religion, "Other", "Religious")
  ))

religion_politics$religion[str_detect(religion_politics$religion, ",")] <- "Multiple responses"

# capitalize political parties
religion_politics <- religion_politics %>%
  mutate(q10_8_text = str_to_title(q10_8_text))

# replace other entry with the political that was entered manually
religion_politics <- religion_politics %>%
  mutate(politics = str_replace(politics, "Other", q10_8_text))

religion_politics$politics[religion_politics$politics == ""] <- "Omitted"

# replace all occurrences of "Not Sure" with "Unsure"
religion_politics$politics <- gsub("Not Sure", "Unsure", religion_politics$politics)

# cleaning up manual entries to closest match, I think
religion_politics$politics <- sub("Anarchy", "Anarchist", religion_politics$politics)
religion_politics$politics <- gsub("Communist.*?\\(Voting Dem\\)", "Communist", religion_politics$politics)
religion_politics$politics <- sub("Dem Soc", "Democratic Socialist", religion_politics$politics)
religion_politics$politics <- sub("No Party Affiliation", "None", religion_politics$politics)
religion_politics$politics <- sub("They All Suck.", "None", religion_politics$politics)
religion_politics$politics <- sub("Moderate. Progun. Prochoice", "Unsure", religion_politics$politics)
religion_politics$politics <- sub("Open-Minded", "Unsure", religion_politics$politics)
religion_politics$politics <- sub("Unsure Just Be Good To Others", "Unsure"
                                  , religion_politics$politics)
religion_politics$politics <- sub("Actual Liberal", "Democrat", religion_politics$politics)
religion_politics$politics <- sub("So Far Left", "Democrat", religion_politics$politics)
religion_politics$politics <- sub("As Left As I Can Vote", "Democrat", religion_politics$politics)
religion_politics$politics <- sub("Anti-Authoritarian Left", "Libertarian Socialist", religion_politics$politics)
religion_politics$politics <- gsub('I"M A Kid', "None", religion_politics$politics)

# make tedious slightly less tedious
values_to_replace <- c("Space", "Men", "Angry", "Angry Leftist", "Annoyed",
                       "Fuck The Gov", "Fuck The Gov And Their Politics", "Human",
                       "Apolitical", "Me", "IM A Kid"
                       )
replacement_value <- "None"
religion_politics$politics <- gsub(paste(values_to_replace, collapse = "|"),
                                   replacement_value, religion_politics$politics)


religion_politics$politics[str_detect(religion_politics$politics, ",")] <- "Multiple responses"
```

```{r include=FALSE}
politics_counts <- table(religion_politics$politics)
religion_counts <- table(religion_politics$religion)

# calculate percentages
politics_percentages <- round(prop.table(politics_counts) * 100, 1)
religion_percentages <- round(prop.table(religion_counts) * 100, 1)

politics_df <- data.frame(
  Politics = names(politics_percentages),
  Counts_Politics = as.numeric(politics_counts),
  Percentage_Politics = politics_percentages
)

religion_df <- data.frame(
  Religion = names(religion_percentages),
  Counts_Religion = as.numeric(religion_counts),
  Percentage_Religion = religion_percentages
)

colnames(religion_df)[colnames(religion_df) == "Percentage_Religion.Freq"] <- "Percent"
colnames(religion_df)[colnames(religion_df) == "Counts_Religion"] <- "Count"
religion_df <- subset(religion_df, select = -Percentage_Religion.Var1)

colnames(politics_df)[colnames(politics_df) == "Percentage_Politics.Freq"] <- "Percent"
colnames(politics_df)[colnames(politics_df) == "Counts_Politics"] <- "Count"
politics_df <- subset(politics_df, select = -Percentage_Politics.Var1)
```

```{r}
religion_politics24 <- data_2024 %>%
  select(religion, politics)

religion_politics24$religion[str_detect(religion_politics24$religion, ",")] <- 
  "Multiple responses"
religion_politics24$politics[str_detect(religion_politics24$politics, ",")] <- 
  "Multiple responses"
```

```{r}
# Clean and standardize the 'politics' column
religion_politics24 <- religion_politics24 %>%
  mutate(
    politics = politics %>%
      trimws() %>%                             # Remove leading/trailing spaces
      tolower() %>%                            # Convert to lowercase
      gsub("omitted\\?", "omitted", .) %>%     # Replace "Omitted?" with "Omitted"
      gsub(" +", " ", .) %>%                   # Remove multiple spaces
      tools::toTitleCase()                     # Convert to title case
  )

# Count the cleaned entries
politics_counts24 <- table(religion_politics24$politics)
```

```{r}
religion_politics24 <- religion_politics24 %>%
  mutate(
    religion = religion %>%
      trimws() %>%                             # Remove leading/trailing spaces
      tolower() %>%                            # Convert to lowercase
      gsub(" +", " ", .) %>%                   # Remove multiple spaces
      tools::toTitleCase()                     # Convert to title case
  )

# Count the cleaned entries
religion_counts24 <- table(religion_politics24$religion)
```

```{r}
# calculate percentages
politics_percentages24 <- round(prop.table(politics_counts24) * 100, 1)
religion_percentages24 <- round(prop.table(religion_counts24) * 100, 1)

politics_df24 <- data.frame(
  Politics = names(politics_percentages24),
  Counts_Politics = as.numeric(politics_counts24),
  Percentage_Politics = politics_percentages24
)
```

```{r}
religion_df24 <- data.frame(
  Religion = names(religion_percentages24),
  Counts_Religion = as.numeric(religion_counts24),
  Percentage_Religion = religion_percentages24
)

colnames(religion_df24)[colnames(religion_df24) == "Percentage_Religion.Freq"] <- "Percent"
colnames(religion_df24)[colnames(religion_df24) == "Counts_Religion"] <- "Count"
religion_df24 <- subset(religion_df24, select = -Percentage_Religion.Var1)

colnames(politics_df24)[colnames(politics_df24) == "Percentage_Politics.Freq"] <- "Percent"
colnames(politics_df24)[colnames(politics_df24) == "Counts_Politics"] <- "Count"
politics_df24 <- subset(politics_df24, select = -Percentage_Politics.Var1)
```

```{r graph politics }
politics_df24$Politics <- factor(politics_df24$Politics,
                               levels = politics_df24$Politics[order(politics_df24$Percent, 
                                                                     decreasing = TRUE)])

politics_df24 %>%
  ggplot(aes(x = Politics, y = Percent)) +
  geom_bar(stat = "identity", color = "black", fill = "lavender") +
  labs(
    x = "Political party",
    y = "SOAK participants in 2024 (%)",
    title = "\nPolitical party affiliation"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

```{r}
politics_df24$Politics <- as.character(politics_df24$Politics)
politics_df24$Politics[8] <- "Multiple responses"
politics_df24$Politics[10] <- "NPP"
```

```{r}
# merge the two tables
pol_combined <- merge(politics_df, politics_df24, by = "Politics", all = TRUE)
```

```{r}
pol_combined <- pol_combined %>% 
  arrange(desc(Percent.y))
```

```{r}
colnames(pol_combined) <- c("Politics", "Count", "Percent", "Count", "Percent")
```

```{r politics table}
pol_combined %>% 
  kbl(caption = if (knitr::is_html_output()) {
      "<span style='font-size: 16px;'>Political party affiliation</span>"
    } else if (knitr::is_latex_output()) {
      "\\textbf{\\large Political party affiliation}"
    }) %>%
  add_header_above(c(" " = 1, "2023" = 2, "2024" = 2)) %>% 
  kable_classic() %>% 
  kable_styling(latex_options = "H")
```
<br> 

The table is organized in descending order by 2024's percent. The most commonly reported political party affiliation was Democrat (43.4%), with no political affiliation coming in second most. Progressive was third most common. These 3 ranked the same in 2023. In 2023, [64.9% of Burners reported Democrat as their party affiliation](https://blackrockcitycensus.org/sociodemo#political-party-affiliation), followed by None or unaffiliated. 

### Religion and Spirituality

```{r}
religion_df24 %>%
  ggplot(aes(x = Religion, y = Percent, fill = Religion)) +
  geom_bar(stat = "identity", color = "black", alpha = 0.8) +
  scale_fill_brewer(palette = "GnBu") +
  labs(
    x = "Religion",
    y = "SOAK participants in 2024 (%)",
    title = "\nReligious or spiritual identity"
  ) +
  geom_text(aes(label = sprintf("%.1f%%", Percent)),
            position = position_stack(vjust = 0.5),
            size = 3.5, color = "black") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        legend.position = "none")

religion_df <- religion_df  %>%
  arrange(desc(Percent))

religion_df24 <- religion_df24 %>% 
  arrange(desc(Percent))
```

```{r}
# fix title case so years align
religion_df24$Religion[7] <- "Multiple responses"
```

```{r}
# merge the two tables
religion_combined <- merge(religion_df, religion_df24, by = "Religion", all = TRUE)
```

```{r}
religion_combined <- religion_combined %>%
  arrange(desc(Percent.y))
```

```{r}
colnames(religion_combined) <- c("Religion", "Count", "Percent", "Count", "Percent")
```

```{r religion table}
religion_combined %>% 
  kbl(caption = if (knitr::is_html_output()) {
      "<span style='font-size: 16px;'>Religious or spiritual identity</span>"
    } else if (knitr::is_latex_output()) {
      "\\textbf{\\large Religious or spiritual identity}"
    }) %>%
  add_header_above(c(" " = 1, "2023" = 2, "2024" = 2)) %>% 
  kable_classic() %>% 
  kable_styling(latex_options = "H")
```
<br> 
The table is organized in descending order by 2024's percent. Spiritual was the highest reported religious or spiritual identity in 2024, same as in 2023. Athiest and agnostic were the 2nd and 3rd most commonly reported identity, respectively. This matches how Burners reported their religious and spiritual beliefs, with [spiritual coming in at 47.4%, atheist at 23.1%, and agnostic at 16.2%](https://blackrockcitycensus.org/sociodemo#spirituality). 

# Sexuality and Relationships

### Sexual Orientation
```{r wrangling 23 orientation}
# create df only containing orientation and relationship data
ori_rel <- data %>%
  select(orientation, q7_7_text, relationship, q8_6_text)

ori_rel$q7_7_text[ori_rel$q7_7_text == "Demi"] <- "Demisexual"

# replace other entry with the what was entered manually
ori_rel <- ori_rel %>%
  mutate(orientation = str_replace(orientation, "Other:", q7_7_text))

#clean up manual entries to make some sense
ori_rel$orientation <- sub("mostly straight", "Heteroflexible", ori_rel$orientation)
ori_rel$orientation <- sub("Decline", "Omitted", ori_rel$orientation)
ori_rel$orientation <- sub("North", "Omitted", ori_rel$orientation)
ori_rel$orientation <- sub("Sexual", "Omitted", ori_rel$orientation)
ori_rel$orientation <- sub("unlabled", "Omitted", ori_rel$orientation)
ori_rel$orientation <- sub("Straight,het-flex", "Heteroflexible", ori_rel$orientation)
ori_rel$orientation <- sub("Straight,Open", "Heteroflexible", ori_rel$orientation)
ori_rel$orientation <- sub("heteroflexible", "Heteroflexible", ori_rel$orientation)
ori_rel$orientation <- sub("Straight,Until proven otherwise", "Heteroflexible", ori_rel$orientation)
ori_rel$orientation <- sub("Bisexual or pansexual,Pansexual", "Bisexual or pansexual",
                           ori_rel$orientation)
ori_rel$orientation[ori_rel$orientation == ""] <- "Omitted"
ori_rel$orientation <- sub("demisexual", "Demisexual", ori_rel$orientation)
ori_rel$orientation[ori_rel$orientation == "sexual"] <- "Omitted"


# replace other entry with the what was entered manually
ori_rel <- ori_rel %>%
  mutate(relationship = str_replace(relationship, "Other", q8_6_text))

#clean up manual entries
ori_rel$relationship[ori_rel$relationship == "undecided"] <- "Unsure/Questioning"
ori_rel$relationship <- sub("Unsure/Questioning,thinking about more than monogamy for the first time ever",
                            "Unsure/Questioning", ori_rel$relationship)

#more efficient than sub but not going to re-code previous chunk
ori_rel$relationship <- gsub("undecided|Experimenting|Divorced & Wondering","Unsure/Questioning",
                             ori_rel$relationship)
ori_rel$relationship <- gsub("solo|single/dating|Single|I'm a kid|Queer AF", "Omitted",
                             ori_rel$relationship)
ori_rel$relationship <- gsub("relationship anarchy|relationship anarchist|Relationship Anardchist"
                             , "Relationship anarchist", ori_rel$relationship)
ori_rel$relationship <- sub("ENM", "Non-monogamous", ori_rel$relationship)
ori_rel$relationship <- sub("aro ace", "Aromantic", ori_rel$relationship)
ori_rel$relationship <- sub("poly by nature, mono by practice", "Polyamorous", ori_rel$relationship)

ori_rel$relationship[ori_rel$relationship == ""] <- "Omitted"
```

```{r count occurences before turning into multiple responses }
# rows (sometimes) store several responses
# pull them out and separate so reporting can be counted individually
orientation_list <- strsplit(ori_rel$orientation, ",")
orientation_unlist <- unlist(orientation_list)
ori_occurrences <- table(orientation_unlist)
ori_occurrences_df <- as.data.frame(ori_occurrences)

relationship_list <- strsplit(ori_rel$relationship, ",")
relationship_unlist <- unlist(relationship_list)
rel_occur <- table(relationship_unlist)
rel_occur_df <- as.data.frame(rel_occur)
```

```{r include=FALSE}
#replace entries with multiple responses with that
ori_rel$orientation[str_detect(ori_rel$orientation, ",")] <- "Multiple responses"
ori_rel$relationship[str_detect(ori_rel$relationship, ",")] <- "Multiple responses"

orientation_counts <- table(ori_rel$orientation)
relationship_counts <- table(ori_rel$relationship)

# calculate percentages
ori_percentages <- round(prop.table(orientation_counts) * 100, 1)
relation_percentages <- round(prop.table(relationship_counts) * 100, 1)

ori_df <- data.frame(
  Orientation = names(ori_percentages),
  Counts_Orientation = as.numeric(orientation_counts),
  Percentage_Orientation = ori_percentages
)

relation_df <- data.frame(
  Relationship = names(relation_percentages),
  Counts_Relations = as.numeric(relationship_counts),
  Percentage_Relation = relation_percentages
)

colnames(ori_df)[colnames(ori_df) == "Percentage_Orientation.Freq"] <- "Percent"
colnames(ori_df)[colnames(ori_df) == "Counts_Orientation"] <- "Count"
ori_df <- subset(ori_df, select = -Percentage_Orientation.Var1)

colnames(relation_df)[colnames(relation_df) == "Percentage_Relation.Freq"] <- "Percent"
colnames(relation_df)[colnames(relation_df) == "Counts_Relations"] <- "Count"
relation_df <- subset(relation_df, select = -Percentage_Relation.Var1)
```

```{r include=FALSE}
ori_occurrences_df$Percent <- round(ori_occurrences_df$Freq / sum(ori_df$Count) * 100, 1)
colnames(ori_occurrences_df) <- c("Orientation", "Count", "Percent")
```

```{r include=FALSE}
rel_occur_df$Percent <- round(rel_occur_df$Freq / sum(relation_df$Count) * 100, 1)
colnames(rel_occur_df) <- c("Relationship", "Count", "Percent")
```

```{r ori rel 24}
ori_rel24 <- data_2024 %>%
  select(orientation, relationship)
```

```{r count occurences before turning into multiple responses 24}
# rows (sometimes) store several responses
# pull them out and separate so reporting can be counted individually
orientation_list <- strsplit(ori_rel24$orientation, ",")
orientation_unlist <- unlist(orientation_list)
ori_occurrences <- table(orientation_unlist)
ori_occurrences_df24 <- as.data.frame(ori_occurrences)
```

```{r}
ori_rel24 <- ori_rel24 %>%
  mutate(
      relationship = relationship %>%
      trimws() %>%                             # Remove leading/trailing spaces
      gsub(" +", " ", .)                       # Remove multiple spaces
  )
```

```{r}
relationship_list <- strsplit(ori_rel24$relationship, ",")
relationship_unlist <- unlist(relationship_list)
rel_occur <- table(relationship_unlist)
rel_occur_df24 <- as.data.frame(rel_occur)
```

```{r relationship orientation dfs 24, include=FALSE}
#replace entries with multiple responses with that
ori_rel24$orientation[str_detect(ori_rel24$orientation, ",")] <- "Multiple responses"
ori_rel24$relationship[str_detect(ori_rel24$relationship, ",")] <- "Multiple responses"

orientation_counts <- table(ori_rel24$orientation)
relationship_counts <- table(ori_rel24$relationship)

# calculate percentages
ori_percentages <- round(prop.table(orientation_counts) * 100, 1)
relation_percentages <- round(prop.table(relationship_counts) * 100, 1)

ori_df24 <- data.frame(
  Orientation = names(ori_percentages),
  Counts_Orientation = as.numeric(orientation_counts),
  Percentage_Orientation = ori_percentages
)

relation_df24 <- data.frame(
  Relationship = names(relation_percentages),
  Counts_Relations = as.numeric(relationship_counts),
  Percentage_Relation = relation_percentages
)

colnames(ori_df24)[colnames(ori_df24) == "Percentage_Orientation.Freq"] <- "Percent"
colnames(ori_df24)[colnames(ori_df24) == "Counts_Orientation"] <- "Count"
ori_df24 <- subset(ori_df24, select = -Percentage_Orientation.Var1)

colnames(relation_df24)[colnames(relation_df24) == "Percentage_Relation.Freq"] <- "Percent"
colnames(relation_df24)[colnames(relation_df24) == "Counts_Relations"] <- "Count"
relation_df24 <- subset(relation_df24, select = -Percentage_Relation.Var1)
```

```{r include=FALSE}
ori_occurrences_df24$Percent <- round(ori_occurrences_df24$Freq / sum(ori_occurrences_df24$Freq) * 100, 1)
colnames(ori_occurrences_df24) <- c("Orientation", "Count", "Percent")
```

```{r include=FALSE}
rel_occur_df24$Percent <- round(rel_occur_df24$Freq / sum(rel_occur_df24$Freq) * 100, 1)
colnames(rel_occur_df24) <- c("Relationship", "Count", "Percent")
```

```{r graph orientation}
#plot percent of people
ori_df24 %>%
  ggplot(aes(x = Orientation, y = Percent, fill = Orientation)) +
  geom_bar(stat = "identity", color = "black", alpha = 0.9) +
  scale_fill_brewer(palette = "Spectral") +
  labs(
    x = "Orientation",
    y = "Participant percentage",
    title = "\nPrimary sexual orientation reported by individuals",
    caption = "Some participants reported multiple orientations and were thus categorized under Multiple responses."
  ) +
   geom_text(aes(label = sprintf("%.1f%%", Percent)),
            position = position_stack(vjust = 0.5),
            size = 3.5, color = "black") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  guides(fill = FALSE)
```

Straight was the most commonly reported sexual orientation in an individual (39.0%) followed by bisexual or pansexual (26.1%) in 2024. The grpah is organized alphabetically and those who reported multiple orientations were clustered into the "Multiple responses" category. The numbers account for the total times an orientation was reported based on the population total. A more granular depiction of the data is further in this section.
<br>

```{r}
# merge the two tables
orientation_combined <- merge(ori_df, ori_df24, by = "Orientation", all = TRUE)
```

```{r}
colnames(orientation_combined) <- c("Orientation", "Count_23", "Percent_23", "Count_24", "Percent_24")
```

```{r long sexual ori}
# Reshape the data into long format
ori_long <- orientation_combined %>%
  pivot_longer(
    cols = c("Percent_23", "Percent_24"),
    names_to = "year",
    values_to = "percent"
  ) %>%
  mutate(year = recode(year, "Percent_23" = "2023", "Percent_24" = "2024"))
```

``` {r longitudinal sexual orientation plot, echo=F}
# Create spaghetti plot
ori_long %>% 
  filter(Orientation != "Omitted") %>% 
  ggplot(aes(x = year, y = percent, group = Orientation, color = Orientation, shape = Orientation)) +
  geom_line(size = 1) +
  geom_point(size = 3) +  # Optional, to emphasize points
  labs(title = "Sexual orientation over time",
       x = "Year",
       y = "Total particpants (%)",
       color = "Orientation",
       shape = "Orientation") +
  theme_minimal() +
  scale_color_brewer(palette = "Paired") +
  scale_x_discrete(expand = c(0.2, 0)) +  # Control x-axis padding
    theme(
          plot.margin = unit(c(0.5, 0.5, 0.1, 0.5), "cm"),  # Tighter plot margin
          axis.title.x = element_text(vjust = -0.5),   # Adjust x-axis label spacing
          axis.title.y = element_text(vjust = 0.5),    # Adjust y-axis label spacing
          axis.text.x = element_text(angle = 45, hjust = 1), # Rotate x-axis labels if needed
          axis.ticks.length = unit(-0.15, "cm"),            # Move ticks closer to axis
          panel.border = element_rect(color = "black", fill = NA, size = 0.5),
          panel.spacing = unit(0.1, "lines"))
```

```{r}
orientation_combined <- orientation_combined %>% 
  arrange(desc(Percent_24))
```

```{r}
colnames(orientation_combined) <- c("Orientation", "Count", "Percent", "Count", "Percent")
```

```{r sex ori table}
orientation_combined %>% 
  kbl(caption = if (knitr::is_html_output()) {
      "<span style='font-size: 16px;'>Sexual orientation</span>"
    } else if (knitr::is_latex_output()) {
      "\\textbf{\\large Sexual orientation}"
    }) %>%
  add_header_above(c(" " = 1, "2023" = 2, "2024" = 2)) %>% 
  kable_classic() %>% 
  kable_styling(latex_options = "H")
```
<br>

The three most commonly reported sexual orientations did not changes across years. In 2024, "heteroflexible" was added to the survey in response to the write-in option used in 2023. This category saw the largest increase from 0.9% to 9.4%. According to an Oregon Live article, [the Oregon LGBTQ+ population is 7.8%](https://www.oregonlive.com/living/2023/12/oregon-has-more-lgbtq-residents-per-capita-than-any-other-state-in-the-us-report.html), with the national population at about 5.6%. That said, the LGBTQ+ population at SOAK is quite large.

```{r graph orientation occurence }
# plot occurrences
ori_occurrences_df24 %>%
  ggplot(aes(x = Orientation,
             y = Count,
             fill = Orientation)) +
  geom_bar(stat = "identity",
           color = "black") +
  scale_fill_brewer(palette = "Spectral") +
  labs(x = "Orientation",
       y = "Number of times reported",
       title = "\nHow many times a sexual orientation was reported") +
  geom_text(aes(label = Count),
            position = position_stack(vjust = 0.5),
            size = 3.5, color = "black") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  guides(fill = FALSE)

ori_occurrences_df24 <- ori_occurrences_df24  %>%
  arrange(desc(Percent))

knitr::kable(ori_occurrences_df24, caption = "Percent in table is calculated by the count divided by the number of total responses")
```

Here we see how many times a sexual orientation was reported. Since folks occasionally selected more than one orientation, we can see how often different orientations were selected instead of only accounting for the individual single identity (or multiple identities) as plotted before. This more detailed look at the data shows how many times each item was selected, thus showing some differences in reporting.

### Relationship Orientation

```{r graph relationship orientation}
#plot percent of people
relation_df24 %>%
  ggplot(aes(x = Relationship, y = Percent, fill = Relationship)) +
  geom_bar(stat = "identity", color = "black", alpha = 0.9) +
  scale_fill_brewer(palette = "Spectral") +
  labs(
    x = "Relationship orientation",
    y = "Participant percentage",
    title = "\nRelationship orientation reported by individuals",
    caption = "Some participants reported multiple orientations\n and were thus categorized under Multiple responses."
  ) +
   geom_text(aes(label = sprintf("%.1f%%", Percent)),
            position = position_stack(vjust = 0.5),
            size = 3.5, color = "black") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  guides(fill = FALSE)
```

Monogamous was the most common relationship orientation at 39.1%, followed by polyamorous at 23.9%, then those who reported multiple orientations. A more detailed look at responses is below. 

```{r}
# merge the two tables
rel_combined <- merge(relation_df, relation_df24, by = "Relationship", all = TRUE)
```

```{r}
colnames(rel_combined) <- c("Relationship", "Count_23", "Percent_23", "Count_24", "Percent_24")
```

```{r}
# Define recategorization rules
rel_combined$Category <- with(rel_combined, case_when(
  Relationship %in% c("Aromantic", "Celibate") ~ "Neither",
  Relationship %in% c("Monogamish", "Non-monogamous", "Open relationship", "Polyamorous", "Relationship anarchist", "Relationship fluid") ~ "Non-monogamous",
  Relationship == "Monogamous" ~ "Monogamous",
  Relationship == "Multiple responses" ~ "Multiple responses",
  Relationship == "Unsure/Questioning" ~ "Unsure/Questioning",
  Relationship == "Omitted" ~ "Omitted",
  TRUE ~ "Other"
))
```

```{r}
# Aggregate the counts and percentages by the new category
rel_simple <- rel_combined %>%
  group_by(Category) %>%
  summarise(
    Count_23 = sum(Count_23, na.rm = TRUE),
    Percent_23 = sum(Percent_23, na.rm = TRUE),
    Count_24 = sum(Count_24, na.rm = TRUE),
    Percent_24 = sum(Percent_24, na.rm = TRUE)
  ) %>%
  arrange(desc(Count_23))  # Optional: Arrange by count in 2023
```

```{r long relationship ori}
# Reshape the data into long format
rel_long <- rel_simple %>%
  pivot_longer(
    cols = c("Percent_23", "Percent_24"),
    names_to = "year",
    values_to = "percent"
  ) %>%
  mutate(year = recode(year, "Percent_23" = "2023", "Percent_24" = "2024"))
```

``` {r longitudinal relationship orientation plot, echo=F}
# Create spaghetti plot
rel_long %>% 
  #filter(Relationship != "Omitted") %>% 
  ggplot(aes(x = year, y = percent, group = Category, color = Category, shape = Category)) +
  geom_line(size = 1) +
  geom_point(size = 3) +  # Optional, to emphasize points
  labs(title = "Relationship orientation over time",
       x = "Year",
       y = "Total particpants (%)",
       color = "Relationship orientation",
       shape = "Relationship orientation",
       caption = "Non-monogamous is combined here to include all reported practices \n of non-monogamy, such as polyamorous and open relationship") +
  theme_minimal() +
  scale_color_brewer(palette = "Paired") +
  scale_x_discrete(expand = c(0.2, 0)) +  # Control x-axis padding
    theme(
          plot.margin = unit(c(0.5, 0.5, 0.1, 0.5), "cm"),  # Tighter plot margin
          axis.title.x = element_text(vjust = -0.5),   # Adjust x-axis label spacing
          axis.title.y = element_text(vjust = 0.5),    # Adjust y-axis label spacing
          axis.text.x = element_text(angle = 45, hjust = 1), # Rotate x-axis labels if needed
          axis.ticks.length = unit(-0.15, "cm"),            # Move ticks closer to axis
          panel.border = element_rect(color = "black", fill = NA, size = 0.5),
          panel.spacing = unit(0.1, "lines"))
```

```{r}
rel_simple <- rel_simple %>% 
  arrange(desc(Percent_24))
```

```{r}
colnames(rel_simple) <- c("Orientation", "Count", "Percent", "Count", "Percent")
```

```{r rel ori table}
rel_simple %>% 
  kbl(caption = if (knitr::is_html_output()) {
      "<span style='font-size: 16px;'>Primary relationship orientation</span>"
    } else if (knitr::is_latex_output()) {
      "\\textbf{\\large Primary relationship orientation}"
    }) %>%
  add_header_above(c(" " = 1, "2023" = 2, "2024" = 2)) %>% 
  kable_classic() %>% 
  kable_styling(latex_options = "H")
```

All practices of the larger "non-monogamy" umbrella were combined for the above longitudinal graph and table to simplify our understanding of SOAK participants.Aromantic and celibate were categorized under "Neither". 

A [2023 YouGov Poll](https://d3nkl3psvxxpe9.cloudfront.net/documents/Monogamy_NonMonogamy_Relationships_Toplines_crosstabs.pdf) found that 55% of Americans align as monogamous, compared to SOAK's 39.1%. This is a small decrease from 2023, where 41% were monogamous. 

```{r graph relationship orientation occurence}
# plot occurrences
rel_occur_df24 %>%
  ggplot(aes(x = Relationship,
             y = Percent,
             fill = Relationship)) +
  geom_bar(stat = "identity",
           color = "black") +
  scale_fill_brewer(palette = "Set3") +
  labs(x = "Relationship orientation",
       y = "Percent of all responses",
       title = "\nRelationship orientation") +
  geom_text(aes(label = sprintf("%.1f%%", Percent)),
            position = position_stack(vjust = 0.5),
            size = 3.5, color = "black") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  guides(fill = FALSE)

rel_occur_df24 <- rel_occur_df24 %>%
  arrange(desc(Percent))

knitr::kable(rel_occur_df24, caption = "The number of times a relationship orientation was reported across all participants, totaling 1070 responses")
```

Here we see how many times a relationship orientation was reported. Since folks occasionally selected more than one, we can see how often different orientations were selected, thus showing some differences in reporting.
<br>

# Event Preferences and Practices

## Transportation and Lodging

### Arrival Time
```{r arrival date and time}
time_counts <- data_2024 %>%
  count(time_arrival, name = "Count")

time_counts$Percent <- round((time_counts$Count / sum(time_counts$Count) * 100), digits = 1)
```

```{r arrival at census}
chronological_order <- c(
  "Wednesday 10 AM - 2 PM",
  "Wednesday 2 PM - 6 PM",
  "Wednesday 6 PM - 10 PM",
  "Thursday 10 AM - 2 PM",
  "Thursday 2 PM - 6 PM",
  "Thursday 6 PM - 10 PM",
  "Friday 10 AM - 2 PM",
  "Friday 2 PM - 6 PM",
  "Omitted"
)

time_cumulative <- data_2024 %>%
  count(time_arrival, name = "Count") %>%
  mutate(
    time_arrival = factor(time_arrival, levels = chronological_order)  # Reorder factor
  ) %>%
  arrange(time_arrival) %>%  # Ensure correct order
  mutate(
    Percent = round(Count / sum(Count) * 100, 1),  # Calculate percentage and round
    CumulativePercent = round(cumsum(Percent), 1)  # Calculate cumulative percent and round
  )
```
<br>
```{r distribution of arrival time to census}
time_counts %>% 
  filter(time_arrival != "Omitted") %>% 
  ggplot(aes(x = reorder(time_arrival, -Count), y = Percent)) +
  geom_bar(stat = "identity", fill = "purple", color = "black", alpha = 0.7) +
  labs(
    title = "Distribution of Census arrival times",
    x = "Time of arrival",
    y = "Number of participants (%)") +
  theme_minimal() +
  theme(
    text = element_text(size = 12),
    axis.text.x = element_text(angle = 45, hjust = 1),  # Rotate x-axis labels for readability
    plot.title = element_text(hjust = 0.5),
    panel.border = element_rect(color = "black", fill = NA, size = 0.5)
  )
```
<br>
```{r cumulative arrival}
time_cumulative %>% 
  filter(time_arrival != "Omitted") %>% 
  ggplot(aes(x = time_arrival, y = CumulativePercent, group = 1)) +
  geom_line(size = 1, color = "darkorchid2") +             # Line plot
  geom_point(size = 3, color = "black") +            # Add points for emphasis
  labs(
    title = "Cumulative distribution of Census participant arrival times",
    x = "Day and time of arrival",
    y = "Cumulative percentage (%)"
  ) +
  scale_y_continuous(limits = c(0, 100)) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),   # Rotate x-axis labels
    plot.title = element_text(hjust = 0.5),
    panel.border = element_rect(color = "black", fill = NA, size = 0.5)
  )
```
<br>
```{r day time arrive table}
colnames(time_cumulative)[1] <- "Arrival"

time_cumulative %>% 
  select(-last_col()) %>% 
  kbl(caption = if (knitr::is_html_output()) {
      "<span style='font-size: 16px;'>Date and time of arrival</span>"
    } else if (knitr::is_latex_output()) {
      "\\textbf{\\large Date and time of arrival}"
    }) %>%
  add_header_above(c(" " = 1, "2024" = 2)) %>% 
  kable_classic() %>% 
  kable_styling(latex_options = "H")
```
<br>

```{r transportation and RV 2023}
# create df only containing transp and RV data
transpo_rv <- data %>%
  select(arrive, rv)

transpo_rv$arrive[transpo_rv$arrive == ""] <- "Omitted"
transpo_rv$rv[transpo_rv$rv == ""] <- "Omitted"

arrive <- table(transpo_rv$arrive)
arrive <- as.data.frame(arrive)
colnames(arrive) <- c("Arrival", "Count")
arrive$Percent <- round((arrive$Count / sum(arrive$Count) * 100), digits = 1)

rv <- table(transpo_rv$rv)
rv <- as.data.frame(rv)
colnames(rv) <- c("Sleeping", "Count")
rv$Percent <- round((rv$Count / sum(rv$Count) * 100), digits = 1)
```

```{r transportation and RV 2024}
# create df only containing transp and RV data
transpo_rv_24 <- data_2024 %>%
  select(arrive, rv)

arrive_24 <- table(transpo_rv_24$arrive)
arrive_24 <- as.data.frame(arrive_24)
colnames(arrive_24) <- c("Arrival", "Count")
arrive_24$Percent <- round((arrive_24$Count / sum(arrive_24$Count) * 100), digits = 1)

rv_24 <- table(transpo_rv_24$rv)
rv_24 <- as.data.frame(rv_24)
colnames(rv_24) <- c("Sleeping", "Count")
rv_24$Percent <- round((rv_24$Count / sum(rv_24$Count) * 100), digits = 1)
```

### Transportation Method

```{r transportation pie chart}
#maths for pie chart
pie_labels_transpo <- arrive_24 %>% 
  mutate(csum = rev(cumsum(rev(Percent))),
         pos = Percent/2 + lead(csum, 1),
         pos = if_else(is.na(pos), Percent/2, pos))

#the plot
arrive_24 %>% 
  ggplot(aes(x = "", y = Percent, fill = fct_inorder(Arrival))) +
  geom_col(width = 1, color = 1) +
  coord_polar(theta = "y") +
  scale_fill_brewer(palette = "Pastel1") +
  geom_label_repel(data = pie_labels_transpo,
                   aes(y = pos, label = paste0(Percent, "%")),
                   size = 4.5, nudge_x = 1, show.legend = FALSE) +
  guides(fill = guide_legend(title = "Question: How did you arrive?")) +
  ggtitle("\n\nTransportation method: Most participants carpooled") +
  labs(caption = paste(sum(arrive_24$Count), "participants, including omitted responses \n")) +
  theme_void() +
  theme(panel.border = element_rect(color = "black", fill = NA, size = 0.5))
```

```{r longitudinal transportation}
# Create a new row with NA values
new_row <- data.frame(Arrival = NA, Count = NA, Percent = NA)

# Insert the new row at the second index
arrive <- rbind(arrive[1:2, ], new_row, arrive[-(1:2), ])
```

```{r combine arrive}
arrive_df <- cbind(arrive, arrive_24)

colnames(arrive_df)[1] <- "Transportation method"
colnames(arrive_df)[2] <- "2023 Count"
colnames(arrive_df)[3] <- "2023 Percent"
colnames(arrive_df)[4] <- "Transportation method 2024"
colnames(arrive_df)[5] <- "2024 Count"
colnames(arrive_df)[6] <- "2024 Percent"
```

```{r create cumulative carpool totals}
# Calculate totals for carpooled
total_carpooled <- arrive_df %>%
  filter(grepl("carpooled", `Transportation method`, ignore.case = TRUE)) %>%
  summarize(
    `Transportation method` = "Total carpooled",
    `2023 Count` = sum(`2023 Count`, na.rm = TRUE),   # Raw count for 2023
    `2023 Percent` = sum(`2023 Percent`, na.rm = TRUE),
    `Transportation method 2024` = "Total carpooled",
    `2024 Count` = sum(`2024 Count`, na.rm = TRUE),   # Raw count for 2024
    `2024 Percent` = sum(`2024 Percent`, na.rm = TRUE)
  )

# Calculate totals for drove solo
total_drove_solo <- arrive_df %>%
  filter(grepl("drove", `Transportation method`, ignore.case = TRUE)) %>%
  summarize(
    `Transportation method` = "Total drove solo",
    `2023 Count` = sum(`2023 Count`, na.rm = TRUE),   # Raw count for 2023
    `2023 Percent` = sum(`2023 Percent`, na.rm = TRUE),
    `Transportation method 2024` = "Total drove solo",
    `2024 Count` = sum(`2024 Count`, na.rm = TRUE),   # Raw count for 2024
    `2024 Percent` = sum(`2024 Percent`, na.rm = TRUE)
  )

# Combine original data with totals
arrive_df <- bind_rows(arrive_df, total_carpooled, total_drove_solo)
```

```{r reshape arrival}
spaghetti_data <- arrive_df %>%
  filter(`Transportation method` %in% c("Total carpooled", "Total drove solo")) %>%
  select(`Transportation method`, `2023 Percent`, `2024 Percent`)

# Reshape the data to long format for ggplot
spaghetti_data_long <- spaghetti_data %>%
  pivot_longer(
    cols = c(`2023 Percent`, `2024 Percent`),
    names_to = "Year",
    values_to = "Percent"
  ) %>%
  mutate(Year = sub(" Percent", "", Year))
```

```{r longitudinal arrival}
# Create the spaghetti plot
spaghetti_data_long %>% 
  ggplot(aes(x = Year, y = Percent, color = `Transportation method`, group = `Transportation method`)) +
  geom_line(size = 1.2) +    # Line for each group
  geom_point(size = 3) +    # Points at each year
  labs(
    title = "How did you arrive at SOAK?",
    x = "Year",
    y = "Total participants who carpooled or drove solo (%)",
    color = "Transportation Method"
  ) +
  theme_minimal() +
  theme(plot.margin = unit(c(0.5, 0.5, 0.1, 0.5), "cm"),  # Tighter plot margin
        panel.border = element_rect(color = "black", fill = NA, size = 0.5),
        panel.spacing = unit(0.1, "lines"),
        legend.position = "top")
```

```{r}
arrive_df <- arrive_df %>% 
  arrange(desc(`2024 Percent`))
```

```{r}
colnames(arrive_df) <- c("Transportation method", "Count", "Percent", "Transportation method", "Count", "Percent")
```

```{r}
arrive_df %>% 
  kbl(caption = if (knitr::is_html_output()) {
      "<span style='font-size: 16px;'>How did you arrive at SOAK?</span>"
    } else if (knitr::is_latex_output()) {
      "\\textbf{\\large How did you arrive at SOAK?}"
    }, 
    row.names = FALSE) %>% 
  add_header_above(c("2023" = 3, "2024" = 3)) %>%  # Ensure 6 columns (3 for 2023, 2 for 2024)
  kable_classic() %>% 
  kable_styling(latex_options = "H")
```
<br>

The majority (67.9%) of participants carpooled to SOAK, although this was a decrease from 2023 when 71.7% of participants carpooled. Despite the introduction of car passes in 2024, there was an increase in those who drove solo from 26.8% to 29.0%. This is less than Burning Man, where [in 2023 only 16.9% of Burners drove solo](https://blackrockcitycensus.org/travel#how-many-people-were-in-your-vehicle-when-you-arrived-at-the-gate).

### Sleeping Arrangement and RV Opinions

```{r RV pie chart}
#maths for pie chart
pie_labels_rv <- rv_24 %>% 
  mutate(csum = rev(cumsum(rev(Percent))),
         pos = Percent/2 + lead(csum, 1),
         pos = if_else(is.na(pos), Percent/2, pos))

#the plot
rv_24 %>% 
  ggplot(aes(x = "", y = Percent, fill = fct_inorder(Sleeping))) +
  geom_col(width = 1, color = 1) +
  coord_polar(theta = "y") +
  scale_fill_brewer(palette = "Pastel1") +
  geom_label_repel(data = pie_labels_rv,
                   aes(y = pos, label = paste0(Percent, "%")),
                   size = 4.5, nudge_x = 1, show.legend = FALSE) +
  guides(fill = guide_legend(title = "Response")) +
  ggtitle("\n\n\nWill you be staying in an RV or camping vehicle?") +
  labs(caption = paste(sum(rv_24$Count), "participants, including omitted responses \n")) +
  theme_void() +
  theme(panel.border = element_rect(color = "black", fill = NA, size = 0.5))
```

```{r longitudinal camping vehicles}
# combine dfs
rv_combined <- cbind(rv, rv_24)
rv_combined <- rv_combined[, -4]
```

```{r long rv}
# Reshape the data into long format
rv_long <- rv_combined %>%
  pivot_longer(cols = c("Percent", "Percent.1"), 
               names_to = "year", 
               values_to = "percent") %>%
  mutate(year = recode(year, "Percent" = "2023", "Percent.1" = "2024"))
```

``` {r longitudinal rv plot}
# Create spaghetti plot
rv_long %>% 
  filter(Sleeping != "Omitted") %>% 
  ggplot(aes(x = year, y = percent, group = Sleeping, color = Sleeping)) +
  geom_line(size = 1) +
  geom_point(size = 3) +  # Optional, to emphasize points
  labs(title = "Are you staying in an RV?",
       x = "Year",
       y = "Total particpants (%)",
       color = "Response") +
  theme_minimal() +
  scale_color_brewer(palette = "Set1") +
  scale_x_discrete(expand = c(0.2, 0)) +  # Control x-axis padding
    theme(
          plot.margin = unit(c(0.5, 0.5, 0.1, 0.5), "cm"),  # Tighter plot margin
          axis.title.x = element_text(vjust = -0.5),   # Adjust x-axis label spacing
          axis.title.y = element_text(vjust = 0.5),    # Adjust y-axis label spacing
          axis.ticks.length = unit(-0.15, "cm"),            # Move ticks closer to axis
          panel.border = element_rect(color = "black", fill = NA, size = 0.5),
          panel.spacing = unit(0.1, "lines"))
```

```{r}
rv_combined <- rv_combined %>% 
  arrange(desc(Percent.1))
```

```{r rv renaming}
colnames(rv_combined)[1] <- "Response"
colnames(rv_combined)[4] <- "Count"
colnames(rv_combined)[5] <- "Percent"
```

```{r rv table}
rv_combined %>% 
  kbl(caption = if (knitr::is_html_output()) {
      "<span style='font-size: 16px;'>Will you be staying in an RV or camping vehicle?</span>"
    } else if (knitr::is_latex_output()) {
      "\\textbf{\\large Will you be staying in an RV or camping vehicle?}"
    }) %>%
  add_header_above(c(" " = 1, "2023" = 2, "2024" = 2)) %>% 
  kable_classic() %>% 
  kable_styling(latex_options = "H")
```
<br>

This question bakes in an opinion in addition to gaining information on how participants sleep at SOAK. Only 11.9% of participants stayed in an RV or camping vehicle, which is a decrease from the previous year. Of those who did not stay in RVs, most did not have an opinion on their presence at SOAK, although more people reported wanting to see less of them than 2023.

### Ticket Acquisition

```{r ticketing}
data$ticket[data$ticket == ""] <- "Omitted"

#count occurrences
ticket_counts <- table(data$ticket)

#convert the result to a data frame
tickets <- data.frame(tickets = names(ticket_counts), count = as.numeric(ticket_counts))
colnames(tickets) <- c("Ticket", "Count")
tickets$Percent <- round((tickets$Count / sum(tickets$Count) * 100), digits = 1)
```

```{r ticketing 2024}
#count occurrences
ticket_counts_24 <- table(data_2024$ticket)

#convert the result to a data frame
tickets_24 <- data.frame(tickets = names(ticket_counts_24), count = as.numeric(ticket_counts_24))
colnames(tickets_24) <- c("Ticket", "Count")
tickets_24$Percent <- round((tickets_24$Count / sum(tickets_24$Count) * 100), digits = 1)
```

```{r ticket plot}
#plot ticket sales
tickets_24 %>% 
  ggplot(aes(x = Ticket, y = Percent, fill = Ticket)) +
  geom_bar(stat = "identity", color = "black") +
  scale_fill_brewer(palette = "PRGn") + 
  labs(
    x = "Acquisition method",
    y = "Participants (%)",
    title = "\nHow did you acquire your SOAK ticket?") +
   geom_text(aes(label = sprintf("%.1f%%", Percent)), 
            position = position_stack(vjust = 0.5), 
            size = 3.5, color = "black") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        panel.border = element_rect(color = "black", fill = NA, size = 0.5)) +
  guides(fill = FALSE)
```

```{r tix for table}
tix_combined <- cbind(tickets, tickets_24)
tix_combined <- tix_combined[, -4]
```

```{r}
tix_combined <- tix_combined %>% 
  arrange(desc(Percent.1))
```

```{r}
colnames(tix_combined)[4] <- "Count"
colnames(tix_combined)[5] <- "Percent"
```

```{r the table}
tix_combined %>% 
  kbl(caption = if (knitr::is_html_output()) {
      "<span style='font-size: 16px;'>How did you acquire your SOAK ticket?</span>"
    } else if (knitr::is_latex_output()) {
      "\\textbf{\\large How did you acquire your SOAK ticket?}"
    }) %>%
  add_header_above(c(" " = 1, "2023" = 2, "2024" = 2)) %>% 
  kable_classic() %>% 
  kable_styling(latex_options = "H")
```

The above table is organized in descending order of 2024 Percent values. Ticket acquisition for SOAK remained mostly done through directed group sales (DGS) at 28.3% in 2024 which was the same in 2023, followed by repaying a friend at 16.6%, then purchasing through the main sale at 12.6%. These 2 methods swapped places in 2024. The largest change occurred in main sale acquisition (dropping 6.5%), whereas volunteer gift tickets went up by 3.2%.

Subsidized tickets (Burning Man's version of the ticket aid program) accounted for 4.8%.

### SOAK Location

```{r move}
#counting occurrences
move_counts <- table(data$move)

#convert the result to a data frame
move <- data.frame(move = names(move_counts), count = as.numeric(move_counts))

colnames(move) <- c("Move", "Count")
move$Percent <- round((move$Count / sum(move$Count) * 100), digits = 1)


#counting occurrences 2024
move_counts_24 <- table(data_2024$move)

#convert the result to a data frame
move_24 <- data.frame(move = names(move_counts_24), count = as.numeric(move_counts_24))

colnames(move_24) <- c("Move", "Count")
move_24$Percent <- round((move_24$Count / sum(move_24$Count) * 100), digits = 1)
```

```{r move combined}
move_combined <- cbind(move, move_24)
move_combined <- move_combined[, -4]
```

```{r move chart}
#maths for pie chart
pie_labels_move <- move_24 %>% 
  mutate(csum = rev(cumsum(rev(Percent))),
         pos = Percent/2 + lead(csum, 1),
         pos = if_else(is.na(pos), Percent/2, pos))

#the plot
move_24 %>% 
  ggplot(aes(x = "", y = Percent, fill = fct_inorder(Move))) +
  geom_col(width = 1, color = 1) +
  coord_polar(theta = "y") +
  scale_fill_brewer(palette = "Paired") +
  geom_label_repel(data = pie_labels_move,
                   aes(y = pos, label = paste0(Percent, "%")),
                   size = 4.5, nudge_x = 1, show.legend = FALSE) +
  guides(fill = guide_legend(title = "Response")) +
  ggtitle("\nWould you attend SOAK if it moved location?") +
  labs(caption = paste(sum(move_24$Count), "participants, including omitted responses \n")) +
  theme_void() +
  theme(panel.border = element_rect(color = "black", fill = NA, size = 0.5))
```

```{r}
colnames(move_combined)[4] <- "Count"
colnames(move_combined)[5] <- "Percent"
colnames(move_combined)[1] <- "Response"

move_combined %>% 
  kbl(caption = if (knitr::is_html_output()) {
      "<span style='font-size: 16px;'>Would you attended SOAK if it moved location?</span>"
    } else if (knitr::is_latex_output()) {
      "\\textbf{\\large Would you attended SOAK if it moved location?}"
    }) %>%
  add_header_above(c(" " = 1, "2023" = 2, "2024" = 2)) %>% 
  kable_classic() %>% 
  kable_styling(latex_options = "H")
```

Most participants (59.2%) would follow SOAK if it moved. Cautiously, 37.1% might attend SOAK if it moved. Perhaps location-dependent? Only a small fraction, 0.7%, claimed they would not attend SOAK if it left Justesen Ranch in Tygh Valley. These values are relatively consistent with 2023.

### Participation

```{r participation}
data$participate[data$participate == ""] <- "Omitted"

# rows (sometimes) store several responses
# parse them out
participate_list <- strsplit(data$participate, ",")
participate_unlist <- unlist(participate_list)
party_occurrences <- table(participate_unlist)
participate_df <- as.data.frame(party_occurrences)

# volunteering as soak lead, director, or producer were categorized separately due to commas - combine
colnames(participate_df) <- c("Participation", "Count")

# manually replacing value with original full value
participate_df$Participation <- as.character(participate_df$Participation)
participate_df[9,1] <- "Volunteering as SOAK lead, director, or producer"

# add rows that were combined
participate_df[9,2] <- sum(participate_df$Count[c(1, 2, 9)])

# drop rows 1 and 2
participate_df <- participate_df[-c(1, 2), ]

participate_df$Percent <- round(participate_df$Count / 670 * 100, 1)
```

```{r participation 2024}
# rows (sometimes) store several responses
# parse them out
participate_list_24 <- strsplit(data_2024$participate, ",")
participate_unlist_24 <- unlist(participate_list_24)
party_occurrences_24 <- table(participate_unlist_24)
participate_df_24 <- as.data.frame(party_occurrences_24)

# volunteering as soak lead, director, or producer were categorized separately due to commas - combine
colnames(participate_df_24) <- c("Participation", "Count")

# manually replacing value with original full value
participate_df_24$Participation <- as.character(participate_df_24$Participation)
participate_df_24[9,1] <- "Volunteering as SOAK lead, director, or producer"

# add rows that were combined
participate_df_24[9,2] <- sum(participate_df_24$Count[c(1, 2, 9)])

# drop rows 1 and 2
participate_df_24 <- participate_df_24[-c(1, 2), ]

participate_df_24$Percent <- round(participate_df_24$Count / 941 * 100, 1)
```

```{r part graph}
participate_df_24$Participation <- factor(participate_df_24$Participation,
                                       levels = participate_df_24$Participation[order(participate_df_24$Count, 
                                                                                      decreasing = TRUE)])

participate_df_24 %>% 
  ggplot(aes(x = Participation,
             y = Count,
             fill = Participation)) +
  geom_bar(stat = "identity",
           color = "black") +
  scale_fill_brewer(palette = "BrBG") +
  labs(x = "How participants participate",
       y = "Number of times reported",
       title = "\nHow will you participate this year?") +
  geom_text(aes(label = Count), 
            position = position_stack(vjust = 0.5), 
            size = 3.5, color = "black") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        panel.border = element_rect(color = "black", fill = NA, size = 0.5)) +
  guides(fill = FALSE)
```

```{r longitudinal participation}
# combine dfs
part_combined <- cbind(participate_df, participate_df_24)
part_combined <- part_combined[, -4]
```

```{r long participation}
# Reshape the data into long format
part_long <- part_combined %>%
  pivot_longer(cols = c("Percent", "Percent.1"), 
               names_to = "year", 
               values_to = "percent") %>%
  mutate(year = recode(year, "Percent" = "2023", "Percent.1" = "2024"))
```

```{r part long graph}
part_long %>% 
  filter(Participation != "Omitted") %>% 
  ggplot(aes(x = year, y = percent, group = Participation, color = Participation,
             shape = Participation)) +
  geom_line(size = 1) +
  geom_point(size = 3) +  # Optional, to emphasize points
  labs(title = "How will you participate this year?",
       x = "Year",
       y = "Total particpants (%)",
       color = "Response",
       shape = "Response") +
  theme_minimal() +
  scale_color_brewer(palette = "Paired") +
  scale_x_discrete(expand = c(0.2, 0)) +  # Control x-axis padding
    theme(
          plot.margin = unit(c(0.5, 0.5, 0.1, 0.5), "cm"),  # Tighter plot margin
          axis.title.x = element_text(vjust = -0.5),   # Adjust x-axis label spacing
          axis.title.y = element_text(vjust = 0.5),    # Adjust y-axis label spacing
          axis.ticks.length = unit(-0.15, "cm"),            # Move ticks closer to axis
          panel.border = element_rect(color = "black", fill = NA, size = 0.5),
          panel.spacing = unit(0.1, "lines"))
```

```{r}
part_combined <- part_combined %>% 
  arrange(desc(Percent.1))
```

```{r}
colnames(part_combined)[4] <- "Count"
colnames(part_combined)[5] <- "Percent"
colnames(part_combined)[1] <- "Response"
```

```{r}
part_combined %>% 
  kbl(caption = if (knitr::is_html_output()) {
      "<span style='font-size: 16px;'>How will you participate this year?</span>"
    } else if (knitr::is_latex_output()) {
      "\\textbf{\\large How will you participate this year?}"
    }, 
    row.names = FALSE) %>%
  add_header_above(c(" " = 1, "2023" = 2, "2024" = 2)) %>% 
  kable_classic() %>% 
  kable_styling(latex_options = "H")
```

How did you participate at SOAK in 2024? Participants could select more than one option, therefore the percent here is out of participants and not responses (totaling above 100). Most people helped bring a theme camp! A total of 52.5% reported bringing a theme camp, which is a decrease from 2023. Second to bringing a camp, 48.1% of people reported interacting with art or theme camps, which increased from 2023.

The least common forms of participation were volunteering as a lead, director, producer, or board member. [Volunteerism in Black Rock City claimed 12.6% of Burners in 2023](https://blackrockcitycensus.org/regionals_media_volunteering#volunteered-in-the-last-year), but 27.6% of SOAKers volunteered with 1 or more SOAK department. This is an increase from 2023, where 19.1% of participants volunteered.

### Sustainability

```{r sustain }
data$sustain[data$sustain == ""] <- "Omitted"

# rows (sometimes) store several responses
# parse them out
sustain_list <- strsplit(data$sustain, ",")
sustain_unlist <- unlist(sustain_list)
sustain_occurrences <- table(sustain_unlist)
sustain_df <- as.data.frame(sustain_occurrences)

colnames(sustain_df) <- c("Sustainability", "Count")
sustain_df$Percent <- round(sustain_df$Count / 670 * 100, 1)
```

```{r}
# rows (sometimes) store several responses
# parse them out
sustain_list <- strsplit(data_2024$sustain, ",")
sustain_unlist <- unlist(sustain_list)
sustain_occurrences24 <- table(sustain_unlist)
sustain_df24 <- as.data.frame(sustain_occurrences24)

colnames(sustain_df24) <- c("Sustainability", "Count")
sustain_df24$Percent <- round(sustain_df24$Count / 941 * 100, 1)
```

```{r sustain plot}
sustain_df24$Sustainability <- factor(sustain_df24$Sustainability,
                                    levels = sustain_df24$Sustainability[order(sustain_df24$Percent,
                                                                             decreasing = TRUE)])
sustain_df24 %>%
  ggplot(aes(x = Sustainability,
             y = Percent,
             fill = Sustainability)) +
  geom_bar(stat = "identity",
           color = "black") +
  scale_fill_brewer(palette = "YlGn") +
  labs(x = "Sustainability method",
       y = "Percent of surveyed individuals",
       title = "\nHow are you contributing to sustainability at SOAK?") +
  geom_text(aes(label = sprintf("%.1f%%", Percent)),
            position = position_stack(vjust = 0.5),
            size = 3.5, color = "black") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  guides(fill = FALSE)
```

```{r}
# merge the two tables
sustain_combined <- merge(sustain_df, sustain_df24, by = "Sustainability", all = TRUE)
```

```{r}
sustain_combined <- sustain_combined  %>%
  arrange(desc(Percent.y))
```

```{r}
colnames(sustain_combined) <- c("Sustainability", "Count", "Percent", "Count", "Percent")
```

```{r sustain table}
sustain_combined %>% 
  kbl(caption = if (knitr::is_html_output()) {
      "<span style='font-size: 16px;'>How are you contributing to sustainability?</span>"
    } else if (knitr::is_latex_output()) {
      "\\textbf{\\large How are you contributing to sustainability?}"
    }) %>%
  add_header_above(c(" " = 1, "2023" = 2, "2024" = 2)) %>% 
  kable_classic() %>% 
  kable_styling(latex_options = "H")
```

### Inclusion of Minors

```{r minors 2023}
# create df only containing bringing kids data
kids <- data %>%
  select(kids, teens)

#replace blanks with Omitted
kids$kids[kids$kids == ""] <- "Omitted"
kids$teens[kids$teens == ""] <- "Omitted"

kids_counts <- table(kids$kids)
teens_counts <- table(kids$teens)

#convert the result to a data frame
kids_2 <- data.frame(kids = names(kids_counts), count = as.numeric(kids_counts))
teens <- data.frame(teens = names(teens_counts), count = as.numeric(teens_counts))

colnames(kids_2) <- c("Kids", "Count")
kids_2$Percent <- round((kids_2$Count / sum(kids_2$Count) * 100), digits = 1)
colnames(teens) <- c("Teens", "Count")
teens$Percent <- round((teens$Count / sum(teens$Count) * 100), digits = 1)
```

```{r minors 2024}
# create df only containing bringing kids data
kids24 <- data_2024 %>%
  select(kids, teens)

kids_counts <- table(kids24$kids)
teens_counts <- table(kids24$teens)

#convert the result to a data frame
kids_24 <- data.frame(kids = names(kids_counts), count = as.numeric(kids_counts))
teens_24 <- data.frame(teens = names(teens_counts), count = as.numeric(teens_counts))
```

```{r}
# Replace "Omitted" with 0 for easier handling
kids_24$kids <- as.character(kids_24$kids) # Ensure 'kids' is treated as a character column
kids_24$kids <- ifelse(kids_24$kids == "Omitted", 0, as.numeric(kids_24$kids))

# Create a new column categorizing "Yes" and "No/Omitted"
kids_24$category <- ifelse(kids_24$kids == 0, "No/Omitted", "Yes")
```

```{r}
# Summarize the counts by category
kids_24_simple <- kids_24 %>%
  group_by(category) %>%
  summarise(Count = sum(count, na.rm = TRUE)) %>%
  ungroup()

# Rename columns to match your desired output
kids_24_simple <- kids_24_simple %>%
  rename(Kids = category)
```

```{r}
kids_24_simple$Percent <- round((kids_24_simple$Count / sum(kids_24_simple$Count) * 100), digits = 1)
```

```{r teens 24}
# Replace "Omitted" with 0 for easier handling
teens_24$teens <- as.character(teens_24$teens)
teens_24$teens <- ifelse(teens_24$teens %in% c("Omitted", "0q"), 0, as.numeric(teens_24$teens))

# Create a new column categorizing "Yes" and "No/Omitted"
teens_24$category <- ifelse(teens_24$teens == 0, "No/Omitted", "Yes")
```

```{r}
# Summarize the counts by category
teens_24_simple <- teens_24 %>%
  group_by(category) %>%
  summarise(Count = sum(count, na.rm = TRUE)) %>%
  ungroup()

# Rename columns to match your desired output
teens_24_simple <- teens_24_simple %>%
  rename(Teens = category)
```

```{r counting participants who brought teens}
teens_24_simple$Percent <- round((teens_24_simple$Count / sum(teens_24_simple$Count) * 100), digits = 1)
```

```{r minors graphed}
#maths for pie chart
pie_labels_kids <- kids_24_simple %>%
  mutate(csum = rev(cumsum(rev(Percent))),
         pos = Percent/2 + lead(csum, 1),
         pos = if_else(is.na(pos), Percent/2, pos))

#the plot
kids_24_simple %>%
  ggplot(aes(x = "", y = Percent, fill = fct_inorder(Kids))) +
  geom_col(width = 1, color = 1) +
  coord_polar(theta = "y") +
  scale_fill_brewer(palette = "PiYG") +
  geom_label_repel(data = pie_labels_kids,
                   aes(y = pos, label = paste0(Percent, "%")),
                   size = 4.5, nudge_x = 1, show.legend = FALSE) +
  guides(fill = guide_legend(title = "Brought children")) +
  ggtitle("\nHow many participants reported bringing any children") +
  labs(caption = paste(sum(kids_24_simple$Count), "participants, omitted and 0 responses combined \n")) +
  theme_void()
```

```{r}
#maths for pie chart
pie_labels_teens <- teens_24_simple %>%
  mutate(csum = rev(cumsum(rev(Percent))),
         pos = Percent/2 + lead(csum, 1),
         pos = if_else(is.na(pos), Percent/2, pos))

#the plot
teens_24_simple %>%
  ggplot(aes(x = "", y = Percent, fill = fct_inorder(Teens))) +
  geom_col(width = 1, color = 1) +
  coord_polar(theta = "y") +
  scale_fill_brewer(palette = "PRGn") +
  geom_label_repel(data = pie_labels_teens,
                   aes(y = pos, label = paste0(Percent, "%")),
                   size = 4.5, nudge_x = 1, show.legend = FALSE) +
  guides(fill = guide_legend(title = "Brought teenagers")) +
  ggtitle("\nHow many participants reported bringing any teenagers") +
  labs(caption = paste(sum(teens_24_simple$Count), "participants, omitted and 0 responses combined\n")) +
  theme_void()
```

```{r total minors brought to soak}
# Filter rows with category == "Yes" and calculate totals for kids
kids_total <- sum(
  kids_24$kids[kids_24$category == "Yes"] * kids_24$count[kids_24$category == "Yes"],
  na.rm = TRUE
)

# Filter rows with category == "Yes" and calculate totals for teens
teens_total <- sum(
  teens_24$teens[teens_24$category == "Yes"] * teens_24$count[teens_24$category == "Yes"],
  na.rm = TRUE
)

# Create the minors_counted data frame
minors_counted <- data.frame(
  kids_total = kids_total,
  teens_total = teens_total
)
```

```{r longitudinal yes minors}
longitudinal_minors <- data.frame(
  Year = rep(c(2023, 2024), each = 2),
  Category = rep(c("Children", "Teens"), times = 2),
  Percent = c(
    kids_2$Percent[kids_2$Kids == "Yes"],
    teens$Percent[teens$Teens == "Yes"],
    kids_24_simple$Percent[kids_24_simple$Kids == "Yes"],
    teens_24_simple$Percent[teens_24_simple$Teens == "Yes"]
  )
)
```

```{r}
# Create the longitudinal plot
longitudinal_minors %>% 
  ggplot(aes(x = Year, y = Percent, group = Category, color = Category)) +
  geom_line(size = 1) +
  geom_point(size = 3) +
  scale_x_continuous(breaks = c(2023, 2024)) +
  scale_color_manual(values = c("Children" = "#87CEFA", "Teens" = "#FFA07A")) +
  labs(
    title = "Participants who reported bringing minors",
    x = "Year",
    y = "Percent",
    color = "Category") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5)) +
    theme(
          plot.margin = unit(c(0.5, 0.5, 0.1, 0.5), "cm"),  # Tighter plot margin
          axis.title.x = element_text(vjust = -0.5),   # Adjust x-axis label spacing
          axis.title.y = element_text(vjust = 0.5),    # Adjust y-axis label spacing
          axis.ticks.length = unit(-0.15, "cm"),            # Move ticks closer to axis
          panel.border = element_rect(color = "black", fill = NA, size = 0.5),
          panel.spacing = unit(0.1, "lines"))
```

Most participants do not bring minors with them to SOAK. The number has decreased between 2023 and 2024.Compared to Burning Man in 2023, [2.8% of Burners reported ever bringing someone under 18 years of age](https://blackrockcitycensus.org/perspectives#bringing-children-under-18-years-old), SOAKers have a higher rate of brining minors. 

```{r}
# Convert minors_counted to a data frame suitable for plotting
minors_plot <- data.frame(
  Category = c("Children", "Teens"),
  Total = c(minors_counted$kids_total, minors_counted$teens_total)
)

# Create the bar plot
ggplot(minors_plot, aes(x = Category, y = Total, fill = Category)) +
  geom_bar(stat = "identity", color = "black", width = 0.6) +
  scale_fill_manual(values = c("Children" = "#87CEFA", "Teens" = "#FFA07A")) +
  geom_text(aes(label = Total), vjust = 2.5, color = "black", size = 4) +
  labs(
    title = "Total counts of minors reportedly brought by participants",
    x = "Age group",
    y = "Total count",
    fill = "Category"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5),
    legend.position = "none" # Remove legend
  )
```

## Town Hall and Burning Man

### Town Hall
```{r townhall}
#counting occurrences
townhall_counts <- table(data$townhall)

#convert the result to a data frame
townhall <- data.frame(move = names(townhall_counts), count = as.numeric(townhall_counts))

colnames(townhall) <- c("Townhall", "Count")
townhall$Percent <- round((townhall$Count / sum(townhall$Count) * 100), digits = 1)

#counting occurrences
townhall_counts_24 <- table(data_2024$townhall)

#convert the result to a data frame
townhall_24 <- data.frame(move = names(townhall_counts_24), count = as.numeric(townhall_counts_24))

colnames(townhall_24) <- c("Townhall", "Count")
townhall_24$Percent <- round((townhall_24$Count / sum(townhall_24$Count) * 100), digits = 1)
```

```{r townhall longitudinal}
# combine townhall dfs
townhall_combined <- cbind(townhall, townhall_24)
townhall_combined <- townhall_combined[, -4]
```

```{r town pie}
#maths for pie chart
pie_labels_town <- townhall_24 %>% 
  mutate(csum = rev(cumsum(rev(Percent))),
         pos = Percent/2 + lead(csum, 1),
         pos = if_else(is.na(pos), Percent/2, pos))

#the plot
townhall_24 %>% 
  ggplot(aes(x = "", y = Percent, fill = fct_inorder(Townhall))) +
  geom_col(width = 1, color = 1) +
  coord_polar(theta = "y") +
  scale_fill_brewer(palette = "RdYlBu") +
  geom_label_repel(data = pie_labels_town,
                   aes(y = pos, label = paste0(Percent, "%")),
                   size = 4.5, nudge_x = 1, show.legend = FALSE) +
  guides(fill = guide_legend(title = "Question: Did you attend Town Hall?")) +
  ggtitle("\nMost participants did not attend Town Hall ") +
  labs(caption = paste(sum(townhall_24$Count), "participants, including omitted responses \n")) +
  theme_void() +
    theme(panel.border = element_rect(color = "black", fill = NA, size = 0.5))
```

```{r}
colnames(townhall_combined)[1] <- "Response"
colnames(townhall_combined)[4] <- "Count"
colnames(townhall_combined)[5] <- "Percent"
```
<br>
```{r}
townhall_combined %>% 
  kbl(caption = if (knitr::is_html_output()) {
      "<span style='font-size: 16px;'>Did you attend Town Hall?</span>"
    } else if (knitr::is_latex_output()) {
      "\\textbf{\\large Did you attend Town Hall?}"
    }) %>%
  add_header_above(c(" " = 1, "2023" = 2, "2024" = 2)) %>% 
  kable_classic() %>% 
  kable_styling(latex_options = "H")
```
<br>

Only 5.3% of people attended SOAK's Town Hall in February, 2024, which is less than in 2023. Most people reported not attending (72.3%), followed by a lack of knowing what Town Hall is (19%), which was more than in 2023.

### Burning Man

```{r bm}
#counting occurrences
bm_counts <- table(data$bm)

#convert the result to a data frame
burning_man <- data.frame(move = names(bm_counts), count = as.numeric(bm_counts))

colnames(burning_man) <- c("BM", "Count")
burning_man$Percent <- round((burning_man$Count / sum(burning_man$Count) * 100), digits = 1)



#counting occurrences 2024
bm_counts_24<- table(data_2024$bm)

#convert the result to a data frame
burning_man_24 <- data.frame(move = names(bm_counts_24), count = as.numeric(bm_counts_24))

colnames(burning_man_24) <- c("BM", "Count")
burning_man_24$Percent <- round((burning_man_24$Count / sum(burning_man_24$Count) * 100), digits = 1)


# combine bm dfs
bm_combined <- cbind(burning_man, burning_man_24)
bm_combined <- bm_combined[, -4]

# # rename the columns
# bm_combined <- bm_combined %>%
#   rename("2023 Percent" = Percent, "2024 Percent" = Percent.1, "Burning Man" = BM) %>%
#   select(`Burning Man`, `2023 Percent`, `2024 Percent`)
```

```{r burning pie}
#maths for pie chart
pie_labels_bm <- burning_man_24 %>% 
  mutate(csum = rev(cumsum(rev(Percent))),
         pos = Percent/2 + lead(csum, 1),
         pos = if_else(is.na(pos), Percent/2, pos))

#the plot
burning_man_24 %>% 
  ggplot(aes(x = "", y = Percent, fill = fct_inorder(BM))) +
  geom_col(width = 1, color = 1) +
  coord_polar(theta = "y") +
  scale_fill_brewer(palette = "BuPu") +
  geom_label_repel(data = pie_labels_bm,
                   aes(y = pos, label = paste0(Percent, "%")),
                   size = 4.5, nudge_x = 1, show.legend = FALSE) +
  guides(fill = guide_legend(title = "Question: Do you plan to go to Burning Man this year?")) +
  ggtitle("\nMost participants did not plan to go to Burning Man ") +
  labs(caption = paste(sum(burning_man_24$Count), "participants, including omitted responses \n")) +
  theme_void() +
  theme(panel.border = element_rect(color = "black", fill = NA, size = 0.5))
```

```{r}
colnames(bm_combined)[1] <- "Response"
colnames(bm_combined)[4] <- "Count"
colnames(bm_combined)[5] <- "Percent"
```

```{r}
bm_combined %>% 
  kbl(caption = if (knitr::is_html_output()) {
      "<span style='font-size: 16px;'>Do you plan to attend Burning Man this year?</span>"
    } else if (knitr::is_latex_output()) {
      "\\textbf{\\large Do you plan to attend Burning Man this year?}"
    }) %>%
  add_header_above(c(" " = 1, "2023" = 2, "2024" = 2)) %>% 
  kable_classic() %>% 
  kable_styling(latex_options = "H")
```

The majority of participants (61.7%) did not plan to go to Burning Man in 2024, followed by 23.1% who planned to go. More people were decisive in 2024 than in 2023, with the unsure response dropping from 17% to 12.2%. 

### Communication

```{r}
# create df only containing communication data
comm <- data %>%
  select(info, q24_9_text)

comm$q24_9_text <- gsub("Carrier pigeon|Apparating|Search", "Omitted", comm$q24_9_text)

comm <- comm %>%
  mutate(info = str_replace(info, "Other", q24_9_text))

comm$info <- gsub("Friends|Friend|friends|friend|Dad|Husband|mother|parents|Partner|Soak Ranger|coco|emails from theme camp|House Potty Discord|Sound Camp Meeting|Slack|slack|campchat|Producers",
                  "Word of mouth", comm$info)

# remove the second occurrence of "Word of mouth" since some entries of "Other" also had Word of mouth selected
comm <- comm %>%
  mutate(info = gsub("Word of mouth,Word of mouth", "Word of mouth", info))
```

```{r}
# rows (sometimes) store several responses
# parse them out
comm_list <- strsplit(comm$info, ",")
comm_unlist <- unlist(comm_list)
comm_occurrences <- table(comm_unlist)
comm_df <- as.data.frame(comm_occurrences)

colnames(comm_df) <- c("Information", "Count")
comm_df$Percent <- round(comm_df$Count / sum(comm_df$Count) * 100, 1)
```

```{r}
# create df only containing communication data
comm24 <- data_2024 %>%
  select(info)
```

```{r}
# Clean and standardize the data
comm24 <- comm24 %>%
  mutate(
    info = info %>%
      trimws() %>%                             # Remove leading/trailing spaces
      gsub(" +", " ", .)                   # Remove multiple spaces
  )
```

```{r}
# rows (sometimes) store several responses
# parse them out
comm_list <- strsplit(comm24$info, ",")
comm_unlist <- unlist(comm_list)
comm_occurrences24 <- table(comm_unlist)
comm_df24 <- as.data.frame(comm_occurrences24)

colnames(comm_df24) <- c("Information", "Count")
comm_df24$Percent <- round(comm_df24$Count / sum(comm_df24$Count) * 100, 1)
```

```{r}
comm_df24$Information <- factor(comm_df24$Information,
                                    levels = comm_df24$Information[order(comm_df24$Percent,
                                                                             decreasing = TRUE)])
comm_df24 %>%
  ggplot(aes(x = Information,
             y = Count,
             fill = Information)) +
  geom_bar(stat = "identity",
           color = "black") +
  scale_fill_brewer(palette = "Blues") +
  labs(x = "Information method",
       y = "Number of times reported",
       title = "\nHow participants received SOAK related information") +
  geom_text(aes(label = Count),
            position = position_stack(vjust = 0.5),
            size = 3.5, color = "black") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  guides(fill = FALSE)
```

```{r}
# merge the two tables
comm_combined <- merge(comm_df, comm_df24, by = "Information", all = TRUE)
```

```{r}
comm_combined <- comm_combined  %>%
  arrange(desc(Percent.y))
```

```{r}
colnames(comm_combined) <- c("Information", "Count", "Percent", "Count", "Percent")
```

```{r comm table}
comm_combined %>% 
  kbl(caption = if (knitr::is_html_output()) {
      "<span style='font-size: 16px;'>How did you receive SOAK related information?</span>"
    } else if (knitr::is_latex_output()) {
      "\\textbf{\\large How did you receive SOAK related information?}"
    }) %>%
  add_header_above(c(" " = 1, "2023" = 2, "2024" = 2)) %>% 
  kable_classic() %>% 
  kable_styling(latex_options = "H")
```

SOAK's mailing list and word of mouth are how most folks receive SOAK information. 